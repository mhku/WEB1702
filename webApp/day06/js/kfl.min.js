var app=angular.module("kfl",["ionic"]);app.service("$kflHttp",["$http","$ionicLoading",function(b,a){this.sendRequest=function(c,d){a.show({template:"loading..."});b.get(c).success(function(e){a.hide();d(e)})}}]);app.config(function(c,b,a){b.tabs.position("bottom");c.state("kflStart",{url:"/kflStart",templateUrl:"tpl/start.html"}).state("kflMain",{url:"/kflMain",templateUrl:"tpl/main.html",controller:"MainCtrl"}).state("kflDetail",{url:"/kflDetail/:id",templateUrl:"tpl/detail.html",controller:"DetailCtrl"}).state("kflOrder",{url:"/kflOrder/:id",templateUrl:"tpl/order.html",controller:"OrderCtrl"}).state("kflMyOrder",{url:"/kflMyOrder",templateUrl:"tpl/myOrder.html",controller:"myOrderCtrl"}).state("kflCart",{url:"/kflCart",templateUrl:"tpl/cart.html",controller:""});a.otherwise("/kflStart")});app.controller("parentCtrl",["$scope","$state",function(a,b){a.jump=function(d,c){b.go(d,c)}}]);app.controller("MainCtrl",["$scope","$kflHttp",function(b,a){b.hasMore=true;a.sendRequest("data/dish_getbypage.php",function(c){console.log(c);b.dishList=c});b.loadMore=function(){a.sendRequest("data/dish_getbypage.php?start="+b.dishList.length,function(c){if(c.length<5){b.hasMore=false}b.dishList=b.dishList.concat(c);b.$broadcast("scroll.infiniteScrollComplete")})};b.inputTxt={kw:""};b.$watch("inputTxt.kw",function(){a.sendRequest("data/dish_getbykw.php?kw="+b.inputTxt.kw,function(c){if(c.length>0){b.dishList=c}})})}]);app.controller("DetailCtrl",["$scope","$kflHttp","$stateParams",function(b,a,c){console.log(c);a.sendRequest("data/dish_getbyid.php?id="+c.id,function(d){console.log(d);b.dish=d[0]})}]);app.controller("OrderCtrl",["$scope","$kflHttp","$stateParams","$httpParamSerializerJQLike",function(b,a,c,d){b.order={did:c.id};b.submitOrder=function(){var e=d(b.order);a.sendRequest("data/order_add.php?"+e,function(f){if(f.length>0){if(f[0].msg=="succ"){sessionStorage.setItem("phone",b.order.phone);b.result="下单成功，订单编号为"+f[0].oid}else{b.result="下单失败"}}})}}]);app.controller("myOrderCtrl",["$scope","$kflHttp",function(b,a){var c=sessionStorage.getItem("phone");a.sendRequest("data/order_getbyphone.php?phone="+c,function(d){console.log(d);b.orderList=d})}]);