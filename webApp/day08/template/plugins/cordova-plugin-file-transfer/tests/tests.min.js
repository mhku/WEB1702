exports.defineAutoTests=function(){var c=1000;var r=600;var f=1024*50;var i="http://foobar.apache.org";var j="http://whatheaders.com";var d=7*c;var p=35*c;var q=7*c;var l=100;var a="¥§©ÆÖÑøøø¼";var t="data:image/png;base64,";var h="iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==";var m=85;var e="http://cordova-vm.apache.org:5000";var g="http://cordova_user:cordova_password@cordova-vm.apache.org:5000";var s=cordova.platformId==="windows8"||cordova.platformId==="windows";var b=cordova.platformId==="windowsphone";var k=cordova.platformId==="browser";var o=k&&navigator.userAgent.indexOf("Trident")>=0;var n=cordova.platformId==="ios";describe("FileTransferError",function(){it("should exist",function(){expect(FileTransferError).toBeDefined()});it("should be constructable",function(){var u=new FileTransferError();expect(u).toBeDefined()});it("filetransfer.spec.3 should expose proper constants",function(){expect(FileTransferError.FILE_NOT_FOUND_ERR).toBeDefined();expect(FileTransferError.INVALID_URL_ERR).toBeDefined();expect(FileTransferError.CONNECTION_ERR).toBeDefined();expect(FileTransferError.ABORT_ERR).toBeDefined();expect(FileTransferError.NOT_MODIFIED_ERR).toBeDefined();expect(FileTransferError.FILE_NOT_FOUND_ERR).toBe(1);expect(FileTransferError.INVALID_URL_ERR).toBe(2);expect(FileTransferError.CONNECTION_ERR).toBe(3);expect(FileTransferError.ABORT_ERR).toBe(4);expect(FileTransferError.NOT_MODIFIED_ERR).toBe(5)})});describe("FileUploadOptions",function(){it("should exist",function(){expect(FileUploadOptions).toBeDefined()});it("should be constructable",function(){var u=new FileUploadOptions();expect(u).toBeDefined()})});describe("FileTransfer",function(){this.persistentRoot=null;this.tempRoot=null;var z={httpFail:function(){},httpWin:function(){},fileSystemFail:function(){},fileSystemWin:function(){},fileOperationFail:function(){},fileOperationWin:function(){}};var y={unsupportedOperation:function(B){console.log("spec called unsupported functionality; response:",B)}};var u=function(D,C,B){D.getFile(C,null,function(E){E.remove(function(){B()},function(){throw new Error("failed to delete: '"+C+"'")})},function(){B()})};var x=function(F,D,E,G,B){var C=function(){z.fileOperationFail();B()};F.getFile(D,{create:true},function(H){H.createWriter(function(J){J.onwrite=function(){G(H)};J.onabort=function(K){throw new Error("aborted creating test file '"+D+"': "+K)};J.error=function(K){throw new Error("aborted creating test file '"+D+"': "+K)};if(cordova.platformId==="browser"){var I=new Blob([E+"\n"],{type:"text/plain"});J.write(I)}else{J.write(E+"\n")}},C)},function(){throw new Error("could not create test file '"+D+"'")})};var w=function(){};var A=function(B){if(B.lengthComputable){expect(B.loaded).toBeGreaterThan(1);expect(B.total).toBeGreaterThan(0);expect(B.total).not.toBeLessThan(B.loaded);expect(B.lengthComputable).toBe(true,"lengthComputable")}else{if(o){expect(B.total).toBe(Math.pow(2,64))}else{expect(B.total).toBeLessThan(1)}}};var v=function(){if(cordova.platformId==="android"||cordova.platformId==="amazon-fireos"){return"httpssss://example.com"}else{return"httpssss://exa mple.com"}};beforeEach(function(B){var C=this;window.requestFileSystem(LocalFileSystem.PERSISTENT,f,function(D){C.persistentRoot=D.root;B()},function(){throw new Error("Failed to initialize persistent file system.")})});beforeEach(function(B){var C=this;window.requestFileSystem(LocalFileSystem.TEMPORARY,f,function(D){C.tempRoot=D.root;B()},function(){throw new Error("Failed to initialize temporary file system.")})});beforeEach(function(){for(var B in z){if(z.hasOwnProperty(B)){spyOn(z,B)}}for(B in y){if(y.hasOwnProperty(B)){spyOn(y,B).and.callThrough()}}});afterEach(function(){for(var B in z){if(z.hasOwnProperty(B)){expect(z[B]).not.toHaveBeenCalled()}}if(y.unsupportedOperation.calls.any()){pending()}});it("should initialise correctly",function(){expect(this.persistentRoot).toBeDefined();expect(this.tempRoot).toBeDefined()});it("should exist",function(){expect(FileTransfer).toBeDefined()});it("filetransfer.spec.1 should be constructable",function(){var B=new FileTransfer();expect(B).toBeDefined()});it("filetransfer.spec.2 should expose proper functions",function(){var B=new FileTransfer();expect(B.upload).toBeDefined();expect(B.download).toBeDefined();expect(B.upload).toEqual(jasmine.any(Function));expect(B.download).toEqual(jasmine.any(Function))});describe("methods",function(){this.transfer=null;this.root=null;this.fileName=null;this.localFilePath=null;beforeEach(function(){this.transfer=new FileTransfer();this.transfer.onprogress=b?w:A;spyOn(this.transfer,"onprogress").and.callThrough();this.root=this.persistentRoot;this.fileName="testFile.txt";this.localFilePath=this.root.toURL()+this.fileName});describe("download",function(){var B=function(D,C){expect(D.name).toBe(C.fileName)};afterEach(function(C){u(this.root,this.fileName,C)});it("ensures that test file does not exist",function(C){u(this.root,this.fileName,C)});it("filetransfer.spec.4 should download a file",function(C){var E=e+"/robots.txt";var I=this;var H=function(K){if(I.transfer.onprogress.calls.any()){var J=I.transfer.onprogress.calls.mostRecent().args[0];expect(J.loaded).not.toBeGreaterThan(K.size)}else{console.log("no progress events were emitted")}C()};var G=function(){z.fileSystemFail();C()};var F=function(){z.httpFail();C()};var D=function(J){B(J,I);J.file(H,G)};I.transfer.download(E,I.localFilePath,D,F)},d);it("filetransfer.spec.5 should download a file using http basic auth",function(C){var E=g+"/download_basic_auth";var G=this;var D=function(H){B(H,G);C()};var F=function(){z.httpFail();C()};G.transfer.download(E,G.localFilePath,D,F)},d);it("filetransfer.spec.6 should get 401 status on http basic auth failure",function(C){var E=e+"/download_basic_auth";var F=function(G){expect(G.http_status).toBe(401);expect(G.http_status).not.toBe(404,"Ensure "+E+" is in the white list");C()};var D=function(){z.httpWin();C()};this.transfer.download(E,this.localFilePath,D,F,null,{headers:{"If-Modified-Since":"Thu, 19 Mar 2015 00:00:00 GMT"}})},d);it("filetransfer.spec.7 should download a file using file:// (when hosted from file://)",function(C){if(s){pending();return}var E=window.location.protocol+"//"+window.location.pathname.replace(/ /g,"%20");var G=this;if(!/^file:/.exec(E)&&cordova.platformId!=="blackberry10"){if(cordova.platformId==="windowsphone"){expect(E).toMatch(/^x-wmapp0:/)}C();return}var D=function(H){B(H,G);C()};var F=function(){z.httpFail();C()};G.transfer.download(E,G.localFilePath,D,F)},d);it("filetransfer.spec.8 should download a file using https://",function(C){var E="https://www.apache.org/licenses/";var J=this;var I=function(){z.httpFail();C()};var F=function(){z.fileOperationFail();C()};var H=function(){z.fileSystemFail();C()};var G=function(L){var K=new FileReader();K.onerror=F;K.onload=function(){expect(K.result).toMatch(/The Apache Software Foundation/);C()};K.readAsText(L)};var D=function(K){B(K,J);K.file(G,H)};J.transfer.download(E,J.localFilePath,D,I)},d);it("filetransfer.spec.11 should call the error callback on abort()",function(C){var E="http://cordova.apache.org/downloads/BlueZedEx.mp3";E=E+"?q="+(new Date()).getTime();var F=this;var D=function(){z.httpWin();C()};F.transfer.download(E,F.localFilePath,D,C);setTimeout(function(){F.transfer.abort()},l)},d);it("filetransfer.spec.9 should not leave partial file due to abort",function(C){var E="http://cordova.apache.org/downloads/logos_2.zip";var H=this;var G=function(){z.fileSystemWin();C()};var D=function(){z.httpWin();C()};var F=function(J){var I=(J.code===FileTransferError.ABORT_ERR||J.code===FileTransferError.CONNECTION_ERR)?true:false;if(!I){fail("Expected "+J.code+" to be "+FileTransferError.ABORT_ERR+" or "+FileTransferError.CONNECTION_ERR)}expect(H.transfer.onprogress).toHaveBeenCalled();H.root.getFile(H.fileName,null,G,C)};H.transfer.onprogress=function(I){if(I.loaded>0){H.transfer.abort()}};spyOn(H.transfer,"onprogress").and.callThrough();H.transfer.download(E,H.localFilePath,D,F)},d);it("filetransfer.spec.10 should be stopped by abort()",function(C){var E="http://cordova.apache.org/downloads/BlueZedEx.mp3";E=E+"?q="+(new Date()).getTime();var G=this;expect(G.transfer.abort).not.toThrow();var D=function(){z.httpWin();C()};var F=function(H){expect(H.code).toBe(FileTransferError.ABORT_ERR);setTimeout(C,r*2)};G.transfer.download(E,G.localFilePath,D,F);setTimeout(function(){G.transfer.abort()},l);setTimeout(function(){expect(G.transfer.abort).not.toThrow()},r)},d);it("filetransfer.spec.12 should get http status on failure",function(C){var E=e+"/404";var F=function(G){expect(G.http_status).not.toBe(401,"Ensure "+E+" is in the white list");expect(G.http_status).toBe(404);if(b){expect(G.code).toBe(FileTransferError.CONNECTION_ERR)}else{expect(G.code).toBe(FileTransferError.FILE_NOT_FOUND_ERR)}C()};var D=function(){z.httpWin();C()};this.transfer.download(E,this.localFilePath,D,F)},d);it("filetransfer.spec.13 should get http body on failure",function(C){var E=e+"/404";var F=function(G){expect(G.http_status).not.toBe(401,"Ensure "+E+" is in the white list");expect(G.http_status).toBe(404);expect(G.body).toBeDefined();expect(G.body).toMatch("You requested a 404");C()};var D=function(){z.httpWin();C()};this.transfer.download(E,this.localFilePath,D,F)},d);it("filetransfer.spec.14 should handle malformed urls",function(C){var E=v();var F=function(G){expect(G.http_status).not.toBe(401,"Ensure "+E+" is in the white list");expect(G.code).toBe(FileTransferError.INVALID_URL_ERR);C()};var D=function(){z.httpWin();C()};this.transfer.download(E,this.localFilePath,D,F)});it("filetransfer.spec.15 should handle unknown host",function(C){var E=i;var F=function(G){expect(G.code).toBe(FileTransferError.CONNECTION_ERR);C()};var D=function(){z.httpWin();C()};this.transfer.onprogress=function(){};this.transfer.download(E,this.localFilePath,D,F)},s?p:d);it("filetransfer.spec.16 should handle bad file path",function(C){var E=e;var D=function(){z.httpWin();C()};this.transfer.download(E,"c:\\54321",D,C)});it("filetransfer.spec.17 progress should work with gzip encoding",function(C){if(cordova.platformId==="blackberry10"){pending();return}var E="http://www.apache.org/";var G=this;var D=function(H){B(H,G);C()};var F=function(){z.httpFail();C()};G.transfer.download(E,G.localFilePath,D,F)},d);it("filetransfer.spec.30 downloaded file entries should have a toNativeURL method",function(C){if(cordova.platformId==="browser"){pending();return}var E=e+"/robots.txt";var D=function(H){expect(H.toNativeURL).toBeDefined();expect(H.toNativeURL).toEqual(jasmine.any(Function));var G=H.toNativeURL();expect(G).toBeTruthy();expect(G).toEqual(jasmine.any(String));if(s){expect(G.substring(0,14)).toBe("ms-appdata:///")}else{if(b){expect(G.substring(0,1)).toBe("/")}else{expect(G.substring(0,7)).toBe("file://")}}C()};var F=function(){z.httpFail();C()};this.transfer.download(E,this.localFilePath,D,F)},d);it("filetransfer.spec.28 (compatibility) should be able to download a file using local paths",function(C){var E=e+"/robots.txt";var H=this;var I=function(J){y.unsupportedOperation(J);C()};var D=function(J){B(J,H);C()};var G;if(H.root.toInternalURL){G=H.root.toInternalURL()+H.fileName}else{G=H.localFilePath}var F=function(){z.httpFail();C()};cordova.exec(function(J){H.transfer.download(E,J,D,F)},I,"File","_getLocalFilesystemPath",[G])});it("filetransfer.spec.33 should properly handle 304",function(C){if(b){pending();return}var E="http://apache.org/images/feather-small.gif";var F=new Date();var G=function(H){expect(H.http_status).toBe(304);expect(H.code).toBe(FileTransferError.NOT_MODIFIED_ERR);C()};var D=function(){z.httpWin();C()};this.transfer.download(E+"?q="+F.getTime(),this.localFilePath,D,G,null,{headers:{"If-Modified-Since":F.toUTCString()}})},d);it("filetransfer.spec.35 304 should not result in the deletion of a cached file",function(F){if(b){pending();return}var E="http://apache.org/images/feather-small.gif";var C=new Date();var J=this;var H=function(){z.fileOperationFail();F()};var K=function(){z.fileSystemFail();F()};var D=function(){z.httpWin();F()};var I=function(){z.httpFail();F()};var G=function(L){expect(L.http_status).toBe(304);expect(L.code).toBe(FileTransferError.NOT_MODIFIED_ERR);J.persistentRoot.getFile(J.fileName,{create:false},function(N){var M=function(P){var O=new FileReader();O.onerror=H;O.onloadend=function(){expect(O.result).toBeTruthy();if(O.result!==null){expect(O.result.length).toBeGreaterThan(0)}F()};O.readAsBinaryString(P)};N.file(M,K)},function(M){expect("Could not open test file '"+J.fileName+"': "+JSON.stringify(M)).not.toBeDefined();F()})};J.transfer.download(E+"?q="+C.getTime(),J.localFilePath,function(){J.transfer.download(E+"?q="+(C.getTime()+1),J.localFilePath,D,G,null,{headers:{"If-Modified-Since":C.toUTCString()}})},I)},d*2);it("filetransfer.spec.36 should handle non-UTF8 encoded download response",function(C){if(!n){pending()}var E=e+"/download_non_utf";var I=this;var F=function(){z.fileOperationFail();C()};var H=function(){z.fileSystemFail();C()};var J=function(){z.httpFail();C()};var G=function(M){if(I.transfer.onprogress.calls.any()){var L=I.transfer.onprogress.calls.mostRecent().args[0];expect(L.loaded).not.toBeGreaterThan(M.size)}else{console.log("no progress events were emitted")}expect(M.size).toBeGreaterThan(0);var K=new FileReader();K.onerror=F;K.onloadend=function(){expect(K.result.indexOf(a)).not.toBe(-1);C()};K.readAsBinaryString(M)};var D=function(K){B(K,I);K.file(G,H)};I.transfer.download(E,I.localFilePath,D,J)},q)});describe("upload",function(){this.uploadParams=null;this.uploadOptions=null;this.fileName=null;this.fileContents=null;this.localFilePath=null;var B=function(C,D){expect(C.bytesSent).toBeGreaterThan(0);expect(C.responseCode).toBe(200);var F=null;try{F=JSON.parse(C.response);expect(F.fields).toBeDefined();expect(F.fields.value1).toBe("test");expect(F.fields.value2).toBe("param")}catch(E){expect(F).not.toBeNull("returned data from server should be valid json")}expect(D.transfer.onprogress).toHaveBeenCalled()};beforeEach(function(C){var E=this;E.fileName="fileToUpload.txt";E.fileContents="upload test file";E.uploadParams={};E.uploadParams.value1="test";E.uploadParams.value2="param";E.uploadOptions=new FileUploadOptions();E.uploadOptions.fileKey="file";E.uploadOptions.fileName=E.fileName;E.uploadOptions.mimeType="text/plain";E.uploadOptions.params=E.uploadParams;var D=function(F){E.localFilePath=F.toURL();C()};x(E.root,E.fileName,E.fileContents,D,C)});afterEach(function(C){u(this.root,this.fileName,C)});it("filetransfer.spec.18 should be able to upload a file",function(C){var E=e+"/upload";var F=this;var G=function(H){B(H,F);if(cordova.platformId==="ios"){expect(H.headers).toBeDefined("Expected headers to be defined.");expect(H.headers["Content-Type"]).toBeDefined("Expected content-type header to be defined.")}C()};var D=function(){z.httpFail();C()};F.transfer.upload(F.localFilePath,E,G,D,F.uploadOptions)},q);it("filetransfer.spec.19 should be able to upload a file with http basic auth",function(C){var E=g+"/upload_basic_auth";var F=this;var G=function(H){B(H,F);C()};var D=function(){z.httpFail();C()};F.transfer.upload(F.localFilePath,E,G,D,F.uploadOptions)},q);it("filetransfer.spec.21 should be stopped by abort()",function(C){var E=e+"/upload";var G=this;var D=function(I){expect(I.code).toBe(FileTransferError.ABORT_ERR);setTimeout(C,r*2)};var H=function(){z.httpWin();C()};var F=function(){expect(G.transfer.abort).not.toThrow();G.transfer.upload(G.localFilePath,E,H,D,G.uploadOptions);setTimeout(function(){G.transfer.abort()},l);setTimeout(function(){expect(G.transfer.abort).not.toThrow()},r)};x(G.root,G.fileName,new Array(200000).join("aborttest!"),F,C)},q);it("filetransfer.spec.22 should get http status and body on failure",function(C){var E=e+"/403";var D=function(G){expect(G.http_status).toBe(403);expect(G.http_status).not.toBe(401,"Ensure "+E+" is in the white list");C()};var F=function(){z.httpWin();C()};this.transfer.upload(this.localFilePath,E,F,D,this.uploadOptions)},q);it("filetransfer.spec.24 should handle malformed urls",function(C){var E=v();var D=function(G){expect(G.code).toBe(FileTransferError.INVALID_URL_ERR);expect(G.http_status).not.toBe(401,"Ensure "+E+" is in the white list");C()};var F=function(){z.httpWin();C()};this.transfer.upload(this.localFilePath,E,F,D,{})});it("filetransfer.spec.25 should handle unknown host",function(C){var E=i;var D=function(G){expect(G.code).toBe(FileTransferError.CONNECTION_ERR);expect(G.http_status).not.toBe(401,"Ensure "+E+" is in the white list");C()};var F=function(){z.httpWin();C()};this.transfer.upload(this.localFilePath,E,F,D,{})},q);it("filetransfer.spec.25 should handle missing file",function(C){var E=e+"/upload";var D=function(G){expect(G.code).toBe(FileTransferError.FILE_NOT_FOUND_ERR);expect(G.http_status).not.toBe(401,"Ensure "+E+" is in the white list");C()};var F=function(){z.httpWin();C()};this.transfer.upload("does_not_exist.txt",E,F,D)},q);it("filetransfer.spec.26 should handle bad file path",function(C){var E=e+"/upload";var D=function(G){expect(G.http_status).not.toBe(401,"Ensure "+E+" is in the white list");C()};var F=function(){z.httpWin();C()};this.transfer.upload("c:\\54321",E,F,D)});it("filetransfer.spec.27 should be able to set custom headers",function(C){var E=j;var F=function(G){expect(G.bytesSent).toBeGreaterThan(0);expect(G.responseCode).toBe(200);expect(G.response).toBeDefined();var H=decodeURIComponent(G.response);expect(H).toMatch(/CustomHeader1[\s\S]*CustomValue1/i);expect(H).toMatch(/CustomHeader2[\s\S]*CustomValue2[\s\S]*CustomValue3/i,"Should allow array values");C()};var D=function(){z.httpFail();C()};this.uploadOptions.headers={CustomHeader1:"CustomValue1",CustomHeader2:["CustomValue2","CustomValue3"]};this.transfer.upload(this.localFilePath,E,F,D,this.uploadOptions)},q);it("filetransfer.spec.29 (compatibility) should be able to upload a file using local paths",function(C){var E=e+"/upload";var G=this;var I=function(J){y.unsupportedOperation(J);C()};var H=function(J){B(J,G);C()};var D=function(){z.httpFail();C()};var F;if(G.root.toInternalURL){F=G.root.toInternalURL()+G.fileName}else{F=G.localFilePath}cordova.exec(function(J){G.transfer.upload(J,E,H,D,G.uploadOptions)},I,"File","_getLocalFilesystemPath",[F])},q);it("filetransfer.spec.31 should be able to upload a file using PUT method",function(C){var E=e+"/upload";var F=this;var G=function(H){B(H,F);if(cordova.platformId==="ios"){expect(H.headers).toBeDefined("Expected headers to be defined.");expect(H.headers["Content-Type"]).toBeDefined("Expected content-type header to be defined.")}C()};var D=function(){z.httpFail();C()};F.uploadOptions.httpMethod="PUT";F.transfer.upload(F.localFilePath,E,G,D,F.uploadOptions)},q);it("filetransfer.spec.32 should be able to upload a file (non-multipart)",function(C){var E=e+"/upload";var F=this;var G=function(H){expect(H.bytesSent).toBeGreaterThan(0);expect(H.responseCode).toBe(200);expect(H.response).toBeDefined();if(H.response){expect(H.response).toEqual(F.fileContents+"\n")}expect(F.transfer.onprogress).toHaveBeenCalled();if(cordova.platformId==="ios"){expect(H.headers).toBeDefined("Expected headers to be defined.");expect(H.headers["Content-Type"]).toBeDefined("Expected content-type header to be defined.")}C()};var D=function(){z.httpFail();C()};F.uploadOptions.headers={"Content-Type":"text/plain"};F.transfer.upload(F.localFilePath,E,G,D,F.uploadOptions)},q);it("filetransfer.spec.34 should not delete a file on upload error",function(C){var E=e+"/upload";var G=this;var D=function(I){expect(I.code).toBe(FileTransferError.ABORT_ERR);G.root.getFile(G.fileName,null,function(J){expect(J).toBeDefined();setTimeout(C,r*2)},function(J){expect(J).not.toBeDefined(J&&J.code);C()})};var H=function(){z.httpWin();C()};var F=function(){expect(G.transfer.abort).not.toThrow();G.transfer.onprogress=function(I){if(I.loaded>0){G.transfer.abort()}};G.transfer.upload(G.localFilePath,E,H,D,G.uploadOptions)};x(G.root,G.fileName,new Array(100000).join("aborttest!"),F,C)},q);it("filetransfer.spec.37 should handle non-UTF8 encoded upload response",function(C){if(!n){pending()}var E=e+"/upload_non_utf";var F=this;var G=function(H){B(H,F);var J=null;try{J=JSON.parse(H.response);expect(J.latin1Symbols).toBe(a)}catch(I){expect(J).not.toBeNull("returned data from server should be valid json")}if(cordova.platformId==="ios"){expect(H.headers).toBeDefined("Expected headers to be defined.");expect(H.headers["Content-Type"]).toBeDefined("Expected content-type header to be defined.")}C()};var D=function(){z.httpFail();C()};F.transfer.upload(F.localFilePath,E,G,D,F.uploadOptions)},q);it("filetransfer.spec.38 should be able to upload a file using data: source uri",function(D){var E=e+"/upload";var F=this;var G=function(H){B(H,F);var J=null;try{J=JSON.parse(H.response);expect(J.files.file.size).toBe(m)}catch(I){expect(J).not.toBeNull("returned data from server should be valid json")}if(cordova.platformId==="ios"){expect(H.headers).toBeDefined("Expected headers to be defined.");expect(H.headers["Content-Type"]).toBeDefined("Expected content-type header to be defined.")}D()};var C=t+h;F.transfer.upload(C,E,G,function(H){console.error("err: "+JSON.stringify(H));expect(H).not.toBeDefined();D()},F.uploadOptions)},q);it("filetransfer.spec.39 should be able to upload a file using data: source uri (non-multipart)",function(D){var F=e+"/upload";var G=function(H){expect(H.responseCode).toBe(200);expect(H.bytesSent).toBeGreaterThan(0);if(cordova.platformId==="ios"){expect(H.headers).toBeDefined("Expected headers to be defined.");expect(H.headers["Content-Type"]).toBeDefined("Expected content-type header to be defined.")}D()};var E=function(){z.httpFail();D()};this.uploadOptions.headers={"Content-Type":"image/png"};var C=t+h;this.transfer.upload(C,F,G,E,this.uploadOptions)},q);it("filetransfer.spec.40 should not fail to upload a file using data: source uri when the data is empty",function(D){var F=e+"/upload";var C=t;var E=function(){z.httpFail();D()};this.transfer.upload(C,F,D,E,this.uploadOptions)},q);it("filetransfer.spec.41 should not fail to upload a file using data: source uri when the data is empty (non-multipart)",function(D){var F=e+"/upload";this.uploadOptions.headers={"Content-Type":"image/png"};this.transfer.onprogress=function(){};var C=t;var E=function(){z.httpFail();D()};this.transfer.upload(C,F,D,E,this.uploadOptions)},q)})})})};exports.defineManualTests=function(d,a){var b="http://apache.org/images/feather-small.gif";var g="http://techslides.com/demos/sample-videos/small.mp4";function c(){var i=document.getElementById("info");i.innerHTML=""}function e(n,k,m,j){var l=n.substring(n.lastIndexOf("/")+1);l=(j||"")+l;function i(p){var q=new FileTransfer();console.log("Starting download");var o=document.getElementById("loadingStatus");o.value=0;q.onprogress=function(r){if(r.lengthComputable){var s=parseInt(100*(r.loaded/r.total),10);if(s>o.value){o.value=s}}else{o.value=null}};q.download(n,p.root.toURL()+l,function(r){console.log("Download complete");m.src=k(r);console.log("Src URL is "+m.src);console.log("Inserting element");document.getElementById("info").appendChild(m)},function(r){console.log("ERROR: ft.download "+r.code)})}console.log("Requesting filesystem");c();window.requestFileSystem(LocalFileSystem.TEMPORARY,0,function(o){console.log("Checking for existing file");if(typeof j!=="undefined"){console.log("Checking for existing directory.");o.root.getDirectory(j,{},function(p){p.removeRecursively(function(){i(o)},function(){console.log("ERROR: dirEntry.removeRecursively")})},function(){i(o)})}else{o.root.getFile(l,{create:false},function(p){console.log("Removing existing file");p.remove(function(){i(o)},function(){console.log("ERROR: entry.remove")})},function(){i(o)})}},function(){console.log("ERROR: requestFileSystem")})}var h='<progress id="loadingStatus" value="0" max="100" style="width: 100%;"></progress>';var f='<h2>Image File Transfer Tests</h2><h3>The following tests should display an image of the Apache feather in the status box</h3><div id="cdv_image"></div><div id="native_image"></div><div id="non-existent_dir"></div><h2>Video File Transfer Tests</h2><h3>The following tests should display a video in the status box. The video should play when play is pressed</h3><div id="cdv_video"></div><div id="native_video"></div>';d.innerHTML='<div id="info"></div><br>'+h+f;a("Download and display img (cdvfile)",function(){e(b,function(i){return i.toInternalURL()},new Image())},"cdv_image");a("Download and display img (native)",function(){e(b,function(i){return i.toURL()},new Image())},"native_image");a("Download to a non-existent dir (should work)",function(){e(b,function(i){return i.toURL()},new Image(),"/nonExistentDirTest/")},"non-existent_dir");a("Download and play video (cdvfile)",function(){var i=document.createElement("video");i.controls="controls";e(g,function(j){return j.toInternalURL()},i)},"cdv_video");a("Download and play video (native)",function(){var i=document.createElement("video");i.controls="controls";e(g,function(j){return j.toURL()},i)},"native_video")};