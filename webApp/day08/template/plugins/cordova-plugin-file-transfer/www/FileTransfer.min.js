var argscheck=require("cordova/argscheck"),exec=require("cordova/exec"),FileTransferError=require("./FileTransferError"),ProgressEvent=require("cordova-plugin-file.ProgressEvent");function newProgressEvent(a){var b=new ProgressEvent();b.lengthComputable=a.lengthComputable;b.loaded=a.loaded;b.total=a.total;return b}function getUrlCredentials(c){var b=/^https?\:\/\/(?:(?:(([^:@\/]*)(?::([^@\/]*))?)?@)?([^:\/?#]*)(?::(\d*))?).*$/,a=b.exec(c);return a&&a[1]}function getBasicAuthHeader(d){var e=null;if(window.btoa){var c=getUrlCredentials(d);if(c){var b="Authorization";var a="Basic "+window.btoa(c);e={name:b,value:a}}}return e}function convertHeadersToArray(c){var a=[];for(var d in c){if(c.hasOwnProperty(d)){var b=c[d];a.push({name:d,value:b.toString()})}}return a}var idCounter=0;var FileTransfer=function(){this._id=++idCounter;this.onprogress=null};FileTransfer.prototype.upload=function(g,f,c,l,q,k){argscheck.checkArgs("ssFFO*","FileTransfer.upload",arguments);var n=null;var i=null;var b=null;var h=null;var p=true;var d=null;var a=null;var j=getBasicAuthHeader(f);if(j){f=f.replace(getUrlCredentials(f)+"@","");q=q||{};q.headers=q.headers||{};q.headers[j.name]=j.value}if(q){n=q.fileKey;i=q.fileName;b=q.mimeType;d=q.headers;a=q.httpMethod||"POST";if(a.toUpperCase()=="PUT"){a="PUT"}else{a="POST"}if(q.chunkedMode!==null||typeof q.chunkedMode!="undefined"){p=q.chunkedMode}if(q.params){h=q.params}else{h={}}}if(cordova.platformId==="windowsphone"){d=d&&convertHeadersToArray(d);h=h&&convertHeadersToArray(h)}var e=l&&function(s){var r=new FileTransferError(s.code,s.source,s.target,s.http_status,s.body,s.exception);l(r)};var o=this;var m=function(r){if(typeof r.lengthComputable!="undefined"){if(o.onprogress){o.onprogress(newProgressEvent(r))}}else{if(c){c(r)}}};exec(m,e,"FileTransfer","upload",[g,f,n,i,b,h,k,p,d,this._id,a])};FileTransfer.prototype.download=function(a,i,b,g,f,k){argscheck.checkArgs("ssFF*","FileTransfer.download",arguments);var j=this;var e=getBasicAuthHeader(a);if(e){a=a.replace(getUrlCredentials(a)+"@","");k=k||{};k.headers=k.headers||{};k.headers[e.name]=e.value}var c=null;if(k){c=k.headers||null}if(cordova.platformId==="windowsphone"&&c){c=convertHeadersToArray(c)}var h=function(l){if(typeof l.lengthComputable!="undefined"){if(j.onprogress){return j.onprogress(newProgressEvent(l))}}else{if(b){var m=null;if(l.isDirectory){m=new (require("cordova-plugin-file.DirectoryEntry"))()}else{if(l.isFile){m=new (require("cordova-plugin-file.FileEntry"))()}}m.isDirectory=l.isDirectory;m.isFile=l.isFile;m.name=l.name;m.fullPath=l.fullPath;m.filesystem=new FileSystem(l.filesystemName||(l.filesystem==window.PERSISTENT?"persistent":"temporary"));m.nativeURL=l.nativeURL;b(m)}}};var d=g&&function(m){var l=new FileTransferError(m.code,m.source,m.target,m.http_status,m.body,m.exception);g(l)};exec(h,d,"FileTransfer","download",[a,i,f,this._id,c])};FileTransfer.prototype.abort=function(){exec(null,null,"FileTransfer","abort",[this._id])};module.exports=FileTransfer;