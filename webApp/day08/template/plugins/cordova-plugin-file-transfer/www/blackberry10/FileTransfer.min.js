var argscheck=require("cordova/argscheck"),FileTransferError=require("./FileTransferError"),xhrImpl=require("./BB10XHRImplementation");function getBasicAuthHeader(b){var d=null;if(window.btoa){var a=document.createElement("a");a.href=b;var c=null;var i=a.protocol+"//";var h=i+a.host;if(a.href.indexOf(h)!==0){var f=a.href.indexOf("@");c=a.href.substring(i.length,f)}if(c){var g="Authorization";var e="Basic "+window.btoa(c);d={name:g,value:e}}}return d}var idCounter=0;var FileTransfer=function(){this._id=++idCounter;this.onprogress=null};FileTransfer.prototype.upload=function(g,f,c,l,q,k){argscheck.checkArgs("ssFFO*","FileTransfer.upload",arguments);var n=null;var i=null;var b=null;var h=null;var p=true;var d=null;var a=null;var j=getBasicAuthHeader(f);if(j){q=q||{};q.headers=q.headers||{};q.headers[j.name]=j.value}if(q){n=q.fileKey;i=q.fileName;b=q.mimeType;d=q.headers;a=q.httpMethod||"POST";if(a.toUpperCase()=="PUT"){a="PUT"}else{a="POST"}if(q.chunkedMode!==null||typeof q.chunkedMode!="undefined"){p=q.chunkedMode}if(q.params){h=q.params}else{h={}}}var e=l&&function(s){var r=new FileTransferError(s.code,s.source,s.target,s.http_status,s.body);l(r)};var o=this;var m=function(r){if(typeof r.lengthComputable!="undefined"){if(o.onprogress){o.onprogress(r)}}else{if(c){c(r)}}};xhrImpl.upload(m,e,[g,f,n,i,b,h,k,p,d,this._id,a])};FileTransfer.prototype.download=function(a,i,b,g,f,k){argscheck.checkArgs("ssFF*","FileTransfer.download",arguments);var j=this;var e=getBasicAuthHeader(a);if(e){k=k||{};k.headers=k.headers||{};k.headers[e.name]=e.value}var c=null;if(k){c=k.headers||null}var h=function(l){if(typeof l.lengthComputable!="undefined"){if(j.onprogress){return j.onprogress(l)}}else{if(b){b(l)}}};var d=g&&function(m){var l=new FileTransferError(m.code,m.source,m.target,m.http_status,m.body);g(l)};xhrImpl.download(h,d,[a,i,f,this._id,c])};FileTransfer.prototype.abort=function(){xhrImpl.abort(null,null,[this._id])};module.exports=FileTransfer;