var exec=require("cordova/exec"),FileError=require("./FileError"),ProgressEvent=require("./ProgressEvent");var FileWriter=function(a){this.fileName="";this.length=0;if(a){this.localURL=a.localURL||a;this.length=a.size||0}this.position=0;this.readyState=0;this.result=null;this.error=null;this.onwritestart=null;this.onprogress=null;this.onwrite=null;this.onwriteend=null;this.onabort=null;this.onerror=null};FileWriter.INIT=0;FileWriter.WRITING=1;FileWriter.DONE=2;FileWriter.prototype.abort=function(){if(this.readyState===FileWriter.DONE||this.readyState===FileWriter.INIT){throw new FileError(FileError.INVALID_STATE_ERR)}this.error=new FileError(FileError.ABORT_ERR);this.readyState=FileWriter.DONE;if(typeof this.onabort==="function"){this.onabort(new ProgressEvent("abort",{target:this}))}if(typeof this.onwriteend==="function"){this.onwriteend(new ProgressEvent("writeend",{target:this}))}};FileWriter.prototype.write=function(f,g){var d=this;var h=(typeof window.Blob!=="undefined"&&typeof window.ArrayBuffer!=="undefined");var b=(cordova.platformId==="windows8"||cordova.platformId==="windows");var e;if(f instanceof File||(!b&&h&&f instanceof Blob)){var a=new FileReader();a.onload=function(){FileWriter.prototype.write.call(d,this.result,true)};a.onerror=function(){d.readyState=FileWriter.DONE;d.error=this.error;if(typeof d.onerror==="function"){d.onerror(new ProgressEvent("error",{target:d}))}if(typeof d.onwriteend==="function"){d.onwriteend(new ProgressEvent("writeend",{target:d}))}};this.readyState=FileWriter.WRITING;if(h){a.readAsArrayBuffer(f)}else{a.readAsText(f)}return}e=h&&(f instanceof ArrayBuffer);if(e&&cordova.platformId==="windowsphone"){f=Array.apply(null,new Uint8Array(f))}if(this.readyState===FileWriter.WRITING&&!g){throw new FileError(FileError.INVALID_STATE_ERR)}this.readyState=FileWriter.WRITING;var c=this;if(typeof c.onwritestart==="function"){c.onwritestart(new ProgressEvent("writestart",{target:c}))}exec(function(i){if(c.readyState===FileWriter.DONE){return}c.position+=i;c.length=c.position;c.readyState=FileWriter.DONE;if(typeof c.onwrite==="function"){c.onwrite(new ProgressEvent("write",{target:c}))}if(typeof c.onwriteend==="function"){c.onwriteend(new ProgressEvent("writeend",{target:c}))}},function(i){if(c.readyState===FileWriter.DONE){return}c.readyState=FileWriter.DONE;c.error=new FileError(i);if(typeof c.onerror==="function"){c.onerror(new ProgressEvent("error",{target:c}))}if(typeof c.onwriteend==="function"){c.onwriteend(new ProgressEvent("writeend",{target:c}))}},"File","write",[this.localURL,f,this.position,e])};FileWriter.prototype.seek=function(a){if(this.readyState===FileWriter.WRITING){throw new FileError(FileError.INVALID_STATE_ERR)}if(!a&&a!==0){return}if(a<0){this.position=Math.max(a+this.length,0)}else{if(a>this.length){this.position=this.length}else{this.position=a}}};FileWriter.prototype.truncate=function(a){if(this.readyState===FileWriter.WRITING){throw new FileError(FileError.INVALID_STATE_ERR)}this.readyState=FileWriter.WRITING;var b=this;if(typeof b.onwritestart==="function"){b.onwritestart(new ProgressEvent("writestart",{target:this}))}exec(function(c){if(b.readyState===FileWriter.DONE){return}b.readyState=FileWriter.DONE;b.length=c;b.position=Math.min(b.position,c);if(typeof b.onwrite==="function"){b.onwrite(new ProgressEvent("write",{target:b}))}if(typeof b.onwriteend==="function"){b.onwriteend(new ProgressEvent("writeend",{target:b}))}},function(c){if(b.readyState===FileWriter.DONE){return}b.readyState=FileWriter.DONE;b.error=new FileError(c);if(typeof b.onerror==="function"){b.onerror(new ProgressEvent("error",{target:b}))}if(typeof b.onwriteend==="function"){b.onwriteend(new ProgressEvent("writeend",{target:b}))}},"File","truncate",[this.localURL,a])};module.exports=FileWriter;