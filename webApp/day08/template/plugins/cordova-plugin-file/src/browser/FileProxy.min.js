(function(){if(require("./isChrome")()){var d={applicationDirectory:location.origin+"/",dataDirectory:"filesystem:file:///persistent/",cacheDirectory:"filesystem:file:///temporary/"};exports.requestAllPaths=function(h){h(d)};require("cordova/exec/proxy").add("File",module.exports);return}var b=require("./LocalFileSystem"),c=require("./FileSystem"),g=require("./FileEntry"),f=require("./FileError"),e=require("./DirectoryEntry"),a=require("./File");(function(o,k){var n=k.indexedDB||k.mozIndexedDB;if(!n){throw"Firefox OS File plugin: indexedDB not supported"}var i=null;var m={};m.db=null;var u="entries";var l="/";var h={applicationDirectory:location.origin+"/",dataDirectory:"file:///persistent/",cacheDirectory:"file:///temporary/"};var q=65535;o.requestFileSystem=function(v,x,z){var C=z[0];var B=z[1];if(C!==b.TEMPORARY&&C!==b.PERSISTENT){if(x){x(f.INVALID_MODIFICATION_ERR)}return}var y=C===b.TEMPORARY?"temporary":"persistent";var A=(location.protocol+location.host).replace(/:/g,"_");var w=new e("",l);i=new c(y,w);m.open(A,function(){v(i)},x)};require("./fileSystems").getFs=function(v,w){w(new c(v,i.root))};o.readEntries=function(v,w,y){var x=y[0];if(typeof v!=="function"){throw Error("Expected successCallback argument.")}var z=s(x);o.getDirectory(function(){m.getAllEntries(z.fullPath+l,z.storagePath,function(A){v(A)},w)},function(){if(w){w(f.NOT_FOUND_ERR)}},[z.storagePath,z.fullPath,{create:false}])};o.getFile=function(v,w,z){var y=z[0];var A=z[1];var x=z[2]||{};A=s(y,A);m.get(A.storagePath,function(C){if(x.create===true&&x.exclusive===true&&C){if(w){w(f.PATH_EXISTS_ERR)}}else{if(x.create===true&&!C){var B=new g(A.fileName,A.fullPath,new c(A.fsName,i.root));B.file_=new r({size:0,name:B.name,lastModifiedDate:new Date(),storagePath:A.storagePath});m.put(B,A.storagePath,v,w)}else{if(x.create===true&&C){if(C.isFile){m["delete"](A.storagePath,function(){var D=new g(A.fileName,A.fullPath,new c(A.fsName,i.root));D.file_=new r({size:0,name:D.name,lastModifiedDate:new Date(),storagePath:A.storagePath});m.put(D,A.storagePath,v,w)},w)}else{if(w){w(f.INVALID_MODIFICATION_ERR)}}}else{if((!x.create||x.create===false)&&!C){if(w){w(f.NOT_FOUND_ERR)}}else{if((!x.create||x.create===false)&&C&&C.isDirectory){if(w){w(f.TYPE_MISMATCH_ERR)}}else{v(j(C))}}}}}},w)};o.getFileMetadata=function(v,w,y){var x=y[0];o.getFile(function(z){v(new a(z.file_.name,z.fullPath,"",z.file_.lastModifiedDate,z.file_.size))},w,[x,null])};o.getMetadata=function(v,w,x){o.getFile(function(y){v({modificationTime:y.file_.lastModifiedDate,size:y.file_.lastModifiedDate})},w,x)};o.setMetadata=function(v,w,z){var y=z[0];var x=z[1];o.getFile(function(A){A.file_.lastModifiedDate=x.modificationTime;m.put(A,A.file_.storagePath,v,w)},w,[y,null])};o.write=function(w,x,y){var B=y[0],A=y[1],v=y[2],z=y[3];if(!A){if(x){x(f.INVALID_MODIFICATION_ERR)}return}if(typeof A==="string"||A instanceof String){A=new Blob([A])}o.getFile(function(G){var F=G.file_.blob_;if(!F){F=new Blob([A],{type:A.type})}else{var D=F.slice(0,v);var C=F.slice(v+(A.size||A.byteLength));var E=v-D.size;if(E<0){E=0}F=new Blob([D,new Uint8Array(E),A,C],{type:A.type})}G.file_.blob_=F;G.file_.lastModifiedDate=new Date()||null;G.file_.size=F.size;G.file_.name=F.name;G.file_.type=F.type;m.put(G,G.file_.storagePath,function(){w(A.size||A.byteLength)},x)},x,[B,null])};o.readAsText=function(v,x,A){var B=A[0],w=A[1],z=A[2],y=A[3];t("text",B,w,z,y,v,x)};o.readAsDataURL=function(v,w,z){var A=z[0],y=z[1],x=z[2];t("dataURL",A,null,y,x,v,w)};o.readAsBinaryString=function(v,w,z){var A=z[0],y=z[1],x=z[2];t("binaryString",A,null,y,x,v,w)};o.readAsArrayBuffer=function(v,w,z){var A=z[0],y=z[1],x=z[2];t("arrayBuffer",A,null,y,x,v,w)};o.removeRecursively=o.remove=function(v,w,y){if(typeof v!=="function"){throw Error("Expected successCallback argument.")}var x=s(y[0]).storagePath;if(x===h.cacheDirectory||x===h.dataDirectory){w(f.NO_MODIFICATION_ALLOWED_ERR);return}function z(A){m["delete"](x,function(){v()},function(){if(w){w()}},A)}o.getDirectory(function(A){z(A.isDirectory)},function(){z(false)},[x,null,{create:false}])};o.getDirectory=function(v,w,z){var y=z[0];var A=z[1];var x=z[2];A=s(y,A);m.get(A.storagePath,function(C){if(!x){x={}}if(x.create===true&&x.exclusive===true&&C){if(w){w(f.PATH_EXISTS_ERR)}return}if(x.create===true&&!C){var B=new e(A.fileName,A.fullPath,new c(A.fsName,i.root));m.put(B,A.storagePath,v,w);return}if(x.create===true&&C){if(C.isDirectory){v(new e(C.name,C.fullPath,C.filesystem))}else{if(w){w(f.INVALID_MODIFICATION_ERR)}}return}if((!x.create||x.create===false)&&!C){if(A.fullPath===l){v(i.root);return}if(w){w(f.NOT_FOUND_ERR)}return}if((!x.create||x.create===false)&&C&&C.isFile){if(w){w(f.TYPE_MISMATCH_ERR)}return}v(new e(C.name,C.fullPath,C.filesystem))},w)};o.getParent=function(v,w,y){if(typeof v!=="function"){throw Error("Expected successCallback argument.")}var x=y[0];if(x===l||x===h.cacheDirectory||x===h.dataDirectory){v(i.root);return}while(x[x.length-1]==="/"){x=x.substr(0,x.length-1)}var A=x.split(l);A.pop();var C=A.pop();var B=A.join(l)+l;var z=B+C+l;if(z===h.cacheDirectory||z===h.dataDirectory){o.getDirectory(v,w,[z,l,{create:false}]);return}o.getDirectory(v,w,[B,C,{create:false}])};o.copyTo=function(v,x,z){var A=z[0];var w=z[1];var y=z[2];if(y.indexOf("/")!==-1||A===w+y){if(x){x(f.INVALID_MODIFICATION_ERR)}return}o.getFile(function(C){var B=s(w);o.getDirectory(function(){o.getFile(function(D){o.write(function(){v(D)},x,[D.file_.storagePath,C.file_.blob_,0])},x,[w,y,{create:true}])},function(){if(x){x(f.NOT_FOUND_ERR)}},[B.storagePath,null,{create:false}])},x,[A,null])};o.moveTo=function(v,x,z){var A=z[0];var w=z[1];var y=z[2];o.copyTo(function(B){o.remove(function(){v(B)},x,[A])},x,z)};o.resolveLocalFileSystemURI=function(w,z,B){var D=B[0];if(D.indexOf("?")!==-1){D=String(D).split("?")[0]}if(/\%5/g.test(D)||/\%20/g.test(D)){D=decodeURI(D)}if(D.trim()[0]==="/"){if(z){z(f.ENCODING_ERR)}return}if(D.trim().substr(0,7)==="cdvfile"){if(D.indexOf("cdvfile://localhost")===-1){if(z){z(f.ENCODING_ERR)}return}var v=D.indexOf("persistent");var x=D.indexOf("temporary");if(v!==-1){D="file:///persistent"+D.substr(v+10)}else{if(x!==-1){D="file:///temporary"+D.substr(x+9)}else{if(z){z(f.ENCODING_ERR)}return}}}function A(G){var E=0;for(var F=0;F<G.length-1;F++){if(G[F]===l&&G[F+1]===l){E=F+1}else{break}}return G.substr(E)}if(D.indexOf("file://localhost/")===0){D=D.replace("file://localhost/","file:///")}if(D.indexOf(h.dataDirectory)===0){D=D.substring(h.dataDirectory.length-1);D=A(D);o.requestFileSystem(function(){o.getFile(w,function(){o.getDirectory(w,z,[h.dataDirectory,D,{create:false}])},[h.dataDirectory,D,{create:false}])},z,[b.PERSISTENT])}else{if(D.indexOf(h.cacheDirectory)===0){D=D.substring(h.cacheDirectory.length-1);D=A(D);o.requestFileSystem(function(){o.getFile(w,function(){o.getDirectory(w,z,[h.cacheDirectory,D,{create:false}])},[h.cacheDirectory,D,{create:false}])},z,[b.TEMPORARY])}else{if(D.indexOf(h.applicationDirectory)===0){D=D.substring(h.applicationDirectory.length);var C=new XMLHttpRequest();C.open("GET",D,true);C.onreadystatechange=function(){if(C.status===200&&C.readyState===4){o.requestFileSystem(function(E){E.name=location.hostname;E.root.getFile(D,{create:true},y,z)},z,[b.PERSISTENT])}};C.onerror=function(){if(z){z(f.NOT_READABLE_ERR)}};C.send()}else{if(z){z(f.NOT_FOUND_ERR)}}}}function y(E){E.createWriter(function(F){F.onwriteend=function(G){if(!G.target.error){E.filesystemName=location.hostname;w(E)}};F.onerror=function(){if(z){z(f.NOT_READABLE_ERR)}};F.write(new Blob([C.response]))},z)}};o.requestAllPaths=function(v){v(h)};function r(v){var w=new Blob();this.size=v.size||0;this.name=v.name||"";this.type=v.type||"";this.lastModifiedDate=v.lastModifiedDate||null;this.storagePath=v.storagePath||"";Object.defineProperty(this,"blob_",{enumerable:true,get:function(){return w},set:function(x){w=x;this.size=w.size;this.name=w.name;this.type=w.type;this.lastModifiedDate=w.lastModifiedDate}.bind(this)})}r.prototype.constructor=r;function s(w,E){E=E||"";var x=E;var A="";w=w||l;if(w.indexOf(FILESYSTEM_PREFIX)===0){A=w.substring(0,w.indexOf(l,FILESYSTEM_PREFIX.length));w=w.substring(w.indexOf(l,FILESYSTEM_PREFIX.length))}var B=E[0]!==l;if(B){x=w;if(w!==l){x+=l+E}else{x+=E}}var D=new RegExp(l+l,"g");x=x.replace(D,l);var y=x.split(l);for(var z=0;z<y.length;++z){var v=y[z];if(v===".."){y[z-1]="";y[z]=""}}x=y.filter(function(F){return F}).join(l);if(x[0]!==l){x=l+x}x=x.replace(/\.\//g,l);x=x.replace(/\/\//g,l);x=x.replace(/\/\./g,l);if(x[x.length-1]===l&&x!==l){x=x.substring(0,x.length-1)}var C=A+x;C=decodeURI(C);x=decodeURI(x);return{storagePath:C,fullPath:x,fileName:x.split(l).pop(),fsName:A.split(l).pop()}}function j(w){var v=new g(w.name,w.fullPath,w.filesystem);v.file_=w.file_;return v}function t(B,z,A,y,x,v,w){o.getFile(function(E){var C=new FileReader(),D=E.file_.blob_.slice(y,x);C.onload=function(F){v(F.target.result)};C.onerror=w;switch(B){case"text":C.readAsText(D,A);break;case"dataURL":C.readAsDataURL(D);break;case"arrayBuffer":C.readAsArrayBuffer(D);break;case"binaryString":C.readAsBinaryString(D);break}},w,[z,null])}m.open=function(z,v,x){var w=this;var y=n.open(z.replace(":","_"));y.onerror=x||p;y.onupgradeneeded=function(A){w.db=A.target.result;w.db.onerror=p;if(!w.db.objectStoreNames.contains(u)){w.db.createObjectStore(u)}};y.onsuccess=function(A){w.db=A.target.result;w.db.onerror=p;v(A)};y.onblocked=x||p};m.close=function(){this.db.close();this.db=null};m.get=function(y,v,x){if(!this.db){if(x){x(f.INVALID_MODIFICATION_ERR)}return}var w=this.db.transaction([u],"readonly");var z=w.objectStore(u).get(y);w.onabort=x||p;w.oncomplete=function(){v(z.result)}};m.getAllEntries=function(z,C,v,y){if(!this.db){if(y){y(f.INVALID_MODIFICATION_ERR)}return}var A=[];if(C[C.length-1]===l){C=C.substring(0,C.length-1)}var x=IDBKeyRange.bound(C+l+" ",C+l+String.fromCharCode(q));var w=this.db.transaction([u],"readonly");w.onabort=y||p;w.oncomplete=function(){A=A.filter(function(G){var D=G.fullPath;if(G.fullPath[G.fullPath.length-1]===l){D=D.substr(0,D.length-1)}var F=D.split(l).length;var E=z.split(l).length;if(z[z.length-1]===l&&z.trim().length===2){E=1}else{if(z[z.length-1]===l){E=z.substr(0,z.length-1).split(l).length}else{E=z.split(l).length}}if(F===E+1){return G}else{return false}});v(A)};var B=w.objectStore(u).openCursor(x);B.onsuccess=function(D){var F=D.target.result;if(F){var E=F.value;A.push(E.isFile?j(E):new e(E.name,E.fullPath,E.filesystem));F["continue"]()}}};m["delete"]=function(y,v,x,z){if(!m.db){if(x){x(f.INVALID_MODIFICATION_ERR)}return}var w=this.db.transaction([u],"readwrite");w.oncomplete=v;w.onabort=x||p;w.oncomplete=function(){if(z){y=y+l;var A=IDBKeyRange.bound(y+" ",y+String.fromCharCode(q));var B=this.db.transaction([u],"readwrite");B.oncomplete=v;B.onabort=x||p;B.objectStore(u)["delete"](A)}else{v()}};w.objectStore(u)["delete"](y)};m.put=function(y,z,v,x){if(!this.db){if(x){x(f.INVALID_MODIFICATION_ERR)}return}var w=this.db.transaction([u],"readwrite");w.onabort=x||p;w.oncomplete=function(){v(y)};w.objectStore(u).put(y,z)};function p(v){switch(v.target.errorCode){case 12:console.log("Error - Attempt to open db with a lower version than the current one.");break;default:console.log("errorCode: "+v.target.errorCode)}console.log(v,v.code,v.message)}})(module.exports,window);require("cordova/exec/proxy").add("File",module.exports)})();