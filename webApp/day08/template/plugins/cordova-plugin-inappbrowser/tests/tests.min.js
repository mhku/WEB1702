var cordova=require("cordova");var isWindows=cordova.platformId=="windows";window.alert=window.alert||navigator.notification.alert;exports.defineAutoTests=function(){describe("cordova.InAppBrowser",function(){it("inappbrowser.spec.1 should exist",function(){expect(cordova.InAppBrowser).toBeDefined()});it("inappbrowser.spec.2 should contain open function",function(){expect(cordova.InAppBrowser.open).toBeDefined();expect(cordova.InAppBrowser.open).toEqual(jasmine.any(Function))})});describe("open method",function(){var b;var e;var d="https://dist.apache.org/repos/dist/dev/cordova/";var f="http://bad-uri/";beforeEach(function(){e=jasmine.DEFAULT_TIMEOUT_INTERVAL;jasmine.DEFAULT_TIMEOUT_INTERVAL=30000;b=null});afterEach(function(g){jasmine.DEFAULT_TIMEOUT_INTERVAL=e;if(b!==null&&b.close){b.close()}b=null;setTimeout(g,2000)});function c(g,h){expect(g).toBeDefined();expect(g.type).toEqual(h);if(h!=="exit"){expect(g.url).toEqual(d)}}function a(g){expect(g).toBeDefined();expect(g.type).toEqual("loaderror");expect(g.url).toEqual(f);expect(g.code).toEqual(jasmine.any(Number));expect(g.message).toEqual(jasmine.any(String))}it("inappbrowser.spec.3 should retun InAppBrowser instance with required methods",function(){b=cordova.InAppBrowser.open(d,"_blank");expect(b).toBeDefined();expect(b.addEventListener).toEqual(jasmine.any(Function));expect(b.removeEventListener).toEqual(jasmine.any(Function));expect(b.close).toEqual(jasmine.any(Function));expect(b.show).toEqual(jasmine.any(Function));expect(b.executeScript).toEqual(jasmine.any(Function));expect(b.insertCSS).toEqual(jasmine.any(Function))});it("inappbrowser.spec.4 should support loadstart and loadstop events",function(g){var h=jasmine.createSpy("loadstart event callback").and.callFake(function(i){c(i,"loadstart")});b=cordova.InAppBrowser.open(d,"_blank");b.addEventListener("loadstart",h);b.addEventListener("loadstop",function(i){c(i,"loadstop");expect(h).toHaveBeenCalled();g()})});it("inappbrowser.spec.5 should support exit event",function(g){b=cordova.InAppBrowser.open(d,"_blank");b.addEventListener("exit",function(h){c(h,"exit");g()});b.close();b=null});it("inappbrowser.spec.6 should support loaderror event",function(g){b=cordova.InAppBrowser.open(f,"_blank");b.addEventListener("loaderror",function(h){a(h);g()})})})};exports.defineManualTests=function(h,d){function o(E,L,G,H,I){H=H||0;I=I||false;console.log("Opening "+E);var M;var O;var P=false;function J(){M={loaderror:0,loadstart:0,loadstop:0,exit:0};O=""}J();var N;var K={loaderror:F,loadstart:F,loadstop:F,exit:F};if(I){console.log("Use window.open() for url");N=window.open(E,L,G,K)}else{N=cordova.InAppBrowser.open(E,L,G,K)}if(!N){alert("open returned "+N);return}function F(R){console.log("IAB event="+JSON.stringify(R));M[R.type]++;if(R.type=="loadstart"){if(R.url==O){alert("Unexpected: loadstart fired multiple times for the same URL.")}O=R.url}if(R.type=="loadstop"||R.type=="loaderror"){if(R.url!=O){alert("Unexpected: "+R.type+" event.url != loadstart's event.url")}if(H===0&&M.loadstart!==1){if(!(R.type=="loaderror"&&M.loadstart===0)){alert("Unexpected: got multiple loadstart events. ("+M.loadstart+")")}}else{if(H>0&&M.loadstart<(H+1)){alert("Unexpected: should have got at least "+(H+1)+" loadstart events, but got "+M.loadstart)}}P=true;H=0;J()}if(R.type=="exit"){var Q=M.loadstop+M.loaderror;if(Q===0&&!P){alert("Unexpected: browser closed without a loadstop or loaderror.")}else{if(Q>1){alert("Unexpected: got multiple loadstop/loaderror events.")}}}}return N}function D(F,H,I,E){var G=window.open;var J=window.hasOwnProperty("open");window.open=cordova.InAppBrowser.open;try{o(F,H,I,E,true)}finally{if(J){window.open=G}else{console.log("just delete, to restore open from prototype");delete window.open}}}function m(E,G,H){var F=o(E,"_blank","location=yes");var I=function(J){if(J&&J.length===0){alert("Results verified")}else{console.log(J);alert("Got: "+typeof(J)+"\n"+JSON.stringify(J))}};if(G){F.addEventListener("loadstop",function(J){F.insertCSS({file:G},H&&I)})}else{F.addEventListener("loadstop",function(J){F.insertCSS({code:"#style-update-literal { \ndisplay: block !important; \n}"},H&&I)})}}function u(E,F,H){var G=o(E,"_blank","location=yes");if(F){G.addEventListener("loadstop",function(I){G.executeScript({file:F},H&&function(J){if(J&&J.length===0){alert("Results verified")}else{console.log(J);alert("Got: "+typeof(J)+"\n"+JSON.stringify(J))}})})}else{G.addEventListener("loadstop",function(J){var I='(function(){\n    var header = document.getElementById("header");\n    header.innerHTML = "Script literal successfully injected";\n    return "abc";\n})()';G.executeScript({code:I},H&&function(K){if(K&&K.length===1&&K[0]==="abc"){alert("Results verified")}else{console.log(K);alert("Got: "+typeof(K)+"\n"+JSON.stringify(K))}})})}}var b=null;var i=function(E){alert("background window loaded ")};function j(E,F){var G=(F)?"hidden=yes":"";b=cordova.InAppBrowser.open(E,"random_string",G);if(!b){alert("cordova.InAppBrowser.open returned "+b);return}if(F){b.addEventListener("loadstop",i)}}function q(){if(!!b){b.show()}}function w(){if(!!b){b.removeEventListener("loadstop",i);b.close();b=null}}var C='<h1>InAppBrowser</h1><div id="info">Make sure http://cordova.apache.org and http://google.co.uk and https://www.google.co.uk are white listed. </br>Make sure http://www.apple.com is not in the white list.</br>In iOS, starred <span style="vertical-align:super">*</span> tests will put the app in a state with no way to return. </br><h4>User-Agent: <span id="user-agent"> </span></hr></div>';var r='<h1>Local URL</h1><div id="openLocal"></div>Expected result: opens successfully in CordovaWebView.<p/> <div id="openLocalHook"></div>Expected result: opens successfully in CordovaWebView (using hook of window.open()).<p/> <div id="openLocalSelf"></div>Expected result: opens successfully in CordovaWebView.<p/> <div id="openLocalSystem"></div>Expected result: fails to open<p/> <div id="openLocalBlank"></div>Expected result: opens successfully in InAppBrowser with locationBar at top.<p/> <div id="openLocalRandomNoLocation"></div>Expected result: opens successfully in InAppBrowser without locationBar.<p/> <div id="openLocalRandomToolBarBottom"></div>Expected result: opens successfully in InAppBrowser with locationBar. On iOS the toolbar is at the bottom.<p/> <div id="openLocalRandomToolBarTop"></div>Expected result: opens successfully in InAppBrowser with locationBar. On iOS the toolbar is at the top.<p/><div id="openLocalRandomToolBarTopNoLocation"></div>Expected result: open successfully in InAppBrowser with no locationBar. On iOS the toolbar is at the top.';var n='<h1>White Listed URL</h1><div id="openWhiteListed"></div>Expected result: open successfully in CordovaWebView to cordova.apache.org<p/> <div id="openWhiteListedHook"></div>Expected result: open successfully in CordovaWebView to cordova.apache.org (using hook of window.open())<p/> <div id="openWhiteListedSelf"></div>Expected result: open successfully in CordovaWebView to cordova.apache.org<p/> <div id="openWhiteListedSystem"></div>Expected result: open successfully in system browser to cordova.apache.org<p/> <div id="openWhiteListedBlank"></div>Expected result: open successfully in InAppBrowser to cordova.apache.org<p/> <div id="openWhiteListedRandom"></div>Expected result: open successfully in InAppBrowser to cordova.apache.org<p/> <div id="openWhiteListedRandomNoLocation"></div>Expected result: open successfully in InAppBrowser to cordova.apache.org with no location bar.';var v='<h1>Non White Listed URL</h1><div id="openNonWhiteListed"></div>Expected result: open successfully in InAppBrowser to apple.com.<p/> <div id="openNonWhiteListedHook"></div>Expected result: open successfully in InAppBrowser to apple.com (using hook of window.open()).<p/> <div id="openNonWhiteListedSelf"></div>Expected result: open successfully in InAppBrowser to apple.com (_self enforces whitelist).<p/> <div id="openNonWhiteListedSystem"></div>Expected result: open successfully in system browser to apple.com.<p/> <div id="openNonWhiteListedBlank"></div>Expected result: open successfully in InAppBrowser to apple.com.<p/> <div id="openNonWhiteListedRandom"></div>Expected result: open successfully in InAppBrowser to apple.com.<p/> <div id="openNonWhiteListedRandomNoLocation"></div>Expected result: open successfully in InAppBrowser to apple.com without locationBar.';var c='<h1>Page with redirect</h1><div id="openRedirect301"></div>Expected result: should 301 and open successfully in InAppBrowser to https://www.google.co.uk.<p/> <div id="openRedirect302"></div>Expected result: should 302 and open successfully in InAppBrowser to www.zhihu.com/answer/16714076.';var g='<h1>PDF URL</h1><div id="openPDF"></div>Expected result: InAppBrowser opens. PDF should render on iOS.<p/> <div id="openPDFBlank"></div>Expected result: InAppBrowser opens. PDF should render on iOS.';var y='<h1>Invalid URL</h1><div id="openInvalidScheme"></div>Expected result: fail to load in InAppBrowser.<p/> <div id="openInvalidHost"></div>Expected result: fail to load in InAppBrowser.<p/> <div id="openInvalidMissing"></div>Expected result: fail to load in InAppBrowser (404).';var k='<h1>CSS / JS Injection</h1><div id="openOriginalDocument"></div>Expected result: open successfully in InAppBrowser without text "Style updated from..."<p/> <div id="openCSSInjection"></div>Expected result: open successfully in InAppBrowser with "Style updated from file".<p/> <div id="openCSSInjectionCallback"></div>Expected result: open successfully in InAppBrowser with "Style updated from file", and alert dialog with text "Results verified".<p/> <div id="openCSSLiteralInjection"></div>Expected result: open successfully in InAppBrowser with "Style updated from literal".<p/> <div id="openCSSLiteralInjectionCallback"></div>Expected result: open successfully in InAppBrowser with "Style updated from literal", and alert dialog with text "Results verified".<p/> <div id="openScriptInjection"></div>Expected result: open successfully in InAppBrowser with text "Script file successfully injected".<p/> <div id="openScriptInjectionCallback"></div>Expected result: open successfully in InAppBrowser with text "Script file successfully injected" and alert dialog with the text "Results verified".<p/> <div id="openScriptLiteralInjection"></div>Expected result: open successfully in InAppBrowser with the text "Script literal successfully injected" .<p/> <div id="openScriptLiteralInjectionCallback"></div>Expected result: open successfully in InAppBrowser with the text "Script literal successfully injected" and alert dialog with the text "Results verified".';var p='<h1>Open Hidden </h1><div id="openHidden"></div>Expected result: no additional browser window. Alert appears with the text "background window loaded".<p/> <div id="showHidden"></div>Expected result: after first clicking on previous test "create hidden", open successfully in InAppBrowser to https://www.google.co.uk.<p/> <div id="closeHidden"></div>Expected result: no output. But click on "show hidden" again and nothing should be shown.<p/> <div id="openHiddenShow"></div>Expected result: open successfully in InAppBrowser to https://www.google.co.uk';var s='<h1>Clearing Cache</h1><div id="openClearCache"></div>Expected result: ?<p/> <div id="openClearSessionCache"></div>Expected result: ?';var x='<h1>Video tag</h1><div id="openRemoteVideo"></div>Expected result: open successfully in InAppBrowser with an embedded video plays automatically on iOS and Android.<div id="openRemoteNeedUserNoVideo"></div>Expected result: open successfully in InAppBrowser with an embedded video plays automatically on iOS and Android.<div id="openRemoteNeedUserYesVideo"></div>Expected result: open successfully in InAppBrowser with an embedded video does not play automatically on iOS and Android but rather works after clicking the "play" button.';var z='<h1>Local with anchor tag</h1><div id="openAnchor1"></div>Expected result: open successfully in InAppBrowser to the local page, scrolled to the top as normal.<p/> <div id="openAnchor2"></div>Expected result: open successfully in InAppBrowser to the local page, scrolled to the beginning of the tall div with border.';if(window.MSApp&&window.MSApp.execUnsafeLocalFunction){MSApp.execUnsafeLocalFunction(function(){h.innerHTML=C+r+n+v+c+g+y+k+p+s+x+z})}else{h.innerHTML=C+r+n+v+c+g+y+k+p+s+x+z}document.getElementById("user-agent").textContent=navigator.userAgent;var B="iab-resources/";var l=B+"local.html",e=B+"local.pdf",A=B+"inject.html",f=isWindows?B+"inject.js":"inject.js",t=isWindows?B+"inject.css":"inject.css",a=B+"video.html";d("target=Default",function(){o(l)},"openLocal");d("target=Default (window.open)",function(){D(l)},"openLocalHook");d("target=_self",function(){o(l,"_self")},"openLocalSelf");d("target=_system",function(){o(l,"_system")},"openLocalSystem");d("target=_blank",function(){o(l,"_blank")},"openLocalBlank");d("target=Random, location=no, disallowoverscroll=yes",function(){o(l,"random_string","location=no, disallowoverscroll=yes")},"openLocalRandomNoLocation");d("target=Random, toolbarposition=bottom",function(){o(l,"random_string","toolbarposition=bottom")},"openLocalRandomToolBarBottom");d("target=Random, toolbarposition=top",function(){o(l,"random_string","toolbarposition=top")},"openLocalRandomToolBarTop");d("target=Random, toolbarposition=top, location=no",function(){o(l,"random_string","toolbarposition=top,location=no")},"openLocalRandomToolBarTopNoLocation");d("* target=Default",function(){o("http://cordova.apache.org")},"openWhiteListed");d("* target=Default (window.open)",function(){D("http://cordova.apache.org")},"openWhiteListedHook");d("* target=_self",function(){o("http://cordova.apache.org","_self")},"openWhiteListedSelf");d("target=_system",function(){o("http://cordova.apache.org","_system")},"openWhiteListedSystem");d("target=_blank",function(){o("http://cordova.apache.org","_blank")},"openWhiteListedBlank");d("target=Random",function(){o("http://cordova.apache.org","random_string")},"openWhiteListedRandom");d("* target=Random, no location bar",function(){o("http://cordova.apache.org","random_string","location=no")},"openWhiteListedRandomNoLocation");d("target=Default",function(){o("http://www.apple.com")},"openNonWhiteListed");d("target=Default (window.open)",function(){D("http://www.apple.com")},"openNonWhiteListedHook");d("target=_self",function(){o("http://www.apple.com","_self")},"openNonWhiteListedSelf");d("target=_system",function(){o("http://www.apple.com","_system")},"openNonWhiteListedSystem");d("target=_blank",function(){o("http://www.apple.com","_blank")},"openNonWhiteListedBlank");d("target=Random",function(){o("http://www.apple.com","random_string")},"openNonWhiteListedRandom");d("* target=Random, no location bar",function(){o("http://www.apple.com","random_string","location=no")},"openNonWhiteListedRandomNoLocation");d("http://google.co.uk",function(){o("http://google.co.uk","random_string","",1)},"openRedirect301");d("http://goo.gl/pUFqg",function(){o("http://goo.gl/pUFqg","random_string","",2)},"openRedirect302");d("Remote URL",function(){o("http://www.stluciadance.com/prospectus_file/sample.pdf")},"openPDF");d("Local URL",function(){o(e,"_blank")},"openPDFBlank");d("Invalid Scheme",function(){o("x-ttp://www.invalid.com/","_blank")},"openInvalidScheme");d("Invalid Host",function(){o("http://www.inv;alid.com/","_blank")},"openInvalidHost");d("Missing Local File",function(){o("nonexistent.html","_blank")},"openInvalidMissing");d("Original Document",function(){o(A,"_blank")},"openOriginalDocument");d("CSS File Injection",function(){m(A,t)},"openCSSInjection");d("CSS File Injection (callback)",function(){m(A,t,true)},"openCSSInjectionCallback");d("CSS Literal Injection",function(){m(A)},"openCSSLiteralInjection");d("CSS Literal Injection (callback)",function(){m(A,null,true)},"openCSSLiteralInjectionCallback");d("Script File Injection",function(){u(A,f)},"openScriptInjection");d("Script File Injection (callback)",function(){u(A,f,true)},"openScriptInjectionCallback");d("Script Literal Injection",function(){u(A)},"openScriptLiteralInjection");d("Script Literal Injection (callback)",function(){u(A,null,true)},"openScriptLiteralInjectionCallback");d("Create Hidden",function(){j("https://www.google.co.uk",true)},"openHidden");d("Show Hidden",function(){q()},"showHidden");d("Close Hidden",function(){w()},"closeHidden");d("google.co.uk Not Hidden",function(){j("https://www.google.co.uk",false)},"openHiddenShow");d("Clear Browser Cache",function(){o("https://www.google.co.uk","_blank","clearcache=yes")},"openClearCache");d("Clear Session Cache",function(){o("https://www.google.co.uk","_blank","clearsessioncache=yes")},"openClearSessionCache");d("Remote Video",function(){o(a,"_blank")},"openRemoteVideo");d("Remote Need User No Video",function(){o(a,"_blank","mediaPlaybackRequiresUserAction=no")},"openRemoteNeedUserNoVideo");d("Remote Need User Yes Video",function(){o(a,"_blank","mediaPlaybackRequiresUserAction=yes")},"openRemoteNeedUserYesVideo");d("Anchor1",function(){o(l+"#bogusanchor","_blank")},"openAnchor1");d("Anchor2",function(){o(l+"#anchor2","_blank")},"openAnchor2")};