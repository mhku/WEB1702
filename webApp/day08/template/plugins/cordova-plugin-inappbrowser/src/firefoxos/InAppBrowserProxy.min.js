var cordova=require("cordova"),channel=require("cordova/channel"),modulemapper=require("cordova/modulemapper");var origOpenFunc=modulemapper.getOriginalSymbol(window,"window.open");var browserWrap;var IABExecs={close:function(a,b){if(browserWrap){browserWrap.parentNode.removeChild(browserWrap);browserWrap=null;if(typeof(a)=="function"){a({type:"exit"})}}},show:function(a,b){console.error("[FirefoxOS] show not implemented")},open:function(k,i,n){var j=n[0],m=n[1],e=n[2]||"location=yes",c={},a,d;var f=e.split(",");f.forEach(function(r){var t=r.split("=");if(t[1]=="yes"){t[1]=true}else{if(t[1]=="no"){t[1]=false}else{var s=parseInt(t[1]);if(!isNaN(s)){t[1]=s}}}c[t[0]]=t[1]});function q(){browserWrap.style.width=window.innerWidth+"px";browserWrap.style.height=window.innerHeight+"px";browserWrap.style.zIndex="999999999";browserWrap.browser.style.height=(window.innerHeight-60)+"px";browserWrap.browser.style.width=browserWrap.style.width}if(m==="_system"){origOpenFunc.apply(window,[j,"_blank"])}else{if(m==="_blank"){var o=document.createElement("iframe");o.setAttribute("mozbrowser",true);o.setAttribute("remote",true);o.setAttribute("src",j);if(browserWrap){document.body.removeChild(browserWrap)}browserWrap=document.createElement("div");browserWrap.browser=o;browserWrap.classList.add("inAppBrowserWrap");browserWrap.style.position="fixed";o.style.position="absolute";o.style.border=0;o.style.top="60px";o.style.left="0px";q();var b=document.createElement("menu");b.setAttribute("type","toolbar");var p=document.createElement("li");var g=document.createElement("li");var h=document.createElement("li");p.appendChild(document.createTextNode("Ã—"));g.appendChild(document.createTextNode("<"));h.appendChild(document.createTextNode(">"));p.classList.add("inAppBrowserClose");g.classList.add("inAppBrowserBack");h.classList.add("inAppBrowserForward");function l(){var r=o.getCanGoBack();r.onsuccess=function(){if(this.result){g.classList.remove("disabled")}else{g.classList.add("disabled")}};var s=o.getCanGoForward();s.onsuccess=function(){if(this.result){h.classList.remove("disabled")}else{h.classList.add("disabled")}}}o.addEventListener("mozbrowserloadend",l);p.addEventListener("click",function(){setTimeout(function(){IABExecs.close(k,i)},0)},false);g.addEventListener("click",function(){o.goBack()},false);h.addEventListener("click",function(){o.goForward()},false);b.appendChild(g);b.appendChild(h);b.appendChild(p);browserWrap.appendChild(b);browserWrap.appendChild(o);document.body.appendChild(browserWrap);o.addEventListener("mozbrowserlocationchange",function(r){k({type:"loadstart",url:r.detail})},false);o.addEventListener("mozbrowserloadend",function(r){k({type:"loadstop"})},false);o.addEventListener("mozbrowsererror",function(r){k({type:"loaderror"})},false);o.addEventListener("mozbrowserclose",function(r){k({type:"exit"})},false)}else{window.location=j}}},injectScriptCode:function(b,a){console.error("[FirefoxOS] injectScriptCode not implemented")},injectScriptFile:function(a,b){console.error("[FirefoxOS] injectScriptFile not implemented")}};module.exports=IABExecs;require("cordova/exec/proxy").add("InAppBrowser",module.exports);