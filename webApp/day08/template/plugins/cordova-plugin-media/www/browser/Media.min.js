var argscheck=require("cordova/argscheck"),utils=require("cordova/utils");var mediaObjects={};function createNode(b){var a=new Audio();a.onloadstart=function(){Media.onStatus(b.id,Media.MEDIA_STATE,Media.MEDIA_STARTING)};a.onplaying=function(){Media.onStatus(b.id,Media.MEDIA_STATE,Media.MEDIA_RUNNING)};a.ondurationchange=function(c){Media.onStatus(b.id,Media.MEDIA_DURATION,c.target.duration||-1)};a.onerror=function(d){var c=d.target.error.code===MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED?{code:MediaError.MEDIA_ERR_ABORTED}:d.target.error;Media.onStatus(b.id,Media.MEDIA_ERROR,c)};a.onended=function(){Media.onStatus(b.id,Media.MEDIA_STATE,Media.MEDIA_STOPPED)};if(b.src){a.src=b.src}return a}var Media=function(e,a,c,b){argscheck.checkArgs("SFFF","Media",arguments);this.id=utils.createUUID();mediaObjects[this.id]=this;this.src=e;this.successCallback=a;this.errorCallback=c;this.statusCallback=b;this._duration=-1;this._position=-1;Media.onStatus(this.id,Media.MEDIA_STATE,Media.MEDIA_STARTING);try{this.node=createNode(this)}catch(d){Media.onStatus(this.id,Media.MEDIA_ERROR,{code:MediaError.MEDIA_ERR_ABORTED})}};Media.MEDIA_STATE=1;Media.MEDIA_DURATION=2;Media.MEDIA_POSITION=3;Media.MEDIA_ERROR=9;Media.MEDIA_NONE=0;Media.MEDIA_STARTING=1;Media.MEDIA_RUNNING=2;Media.MEDIA_PAUSED=3;Media.MEDIA_STOPPED=4;Media.MEDIA_MSG=["None","Starting","Running","Paused","Stopped"];Media.prototype.play=function(){if(!this.node){try{this.node=createNode(this)}catch(a){Media.onStatus(this.id,Media.MEDIA_ERROR,{code:MediaError.MEDIA_ERR_ABORTED})}}this.node.play()};Media.prototype.stop=function(){try{this.pause();this.seekTo(0);Media.onStatus(this.id,Media.MEDIA_STATE,Media.MEDIA_STOPPED)}catch(a){Media.onStatus(this.id,Media.MEDIA_ERROR,a)}};Media.prototype.seekTo=function(a){try{this.node.currentTime=a/1000}catch(b){Media.onStatus(this.id,Media.MEDIA_ERROR,b)}};Media.prototype.pause=function(){try{this.node.pause();Media.onStatus(this.id,Media.MEDIA_STATE,Media.MEDIA_PAUSED)}catch(a){Media.onStatus(this.id,Media.MEDIA_ERROR,a)}};Media.prototype.getDuration=function(){return this._duration};Media.prototype.getCurrentPosition=function(d,a){try{var c=this.node.currentTime;Media.onStatus(this.id,Media.MEDIA_POSITION,c);d(c)}catch(b){a(b)}};Media.prototype.startRecord=function(){Media.onStatus(this.id,Media.MEDIA_ERROR,"Not supported")};Media.prototype.stopRecord=function(){Media.onStatus(this.id,Media.MEDIA_ERROR,"Not supported")};Media.prototype.release=function(){try{delete this.node}catch(a){Media.onStatus(this.id,Media.MEDIA_ERROR,a)}};Media.prototype.setVolume=function(a){this.node.volume=a};Media.onStatus=function(d,a,b){var c=mediaObjects[d];if(c){switch(a){case Media.MEDIA_STATE:c.statusCallback&&c.statusCallback(b);if(b===Media.MEDIA_STOPPED){c.successCallback&&c.successCallback()}break;case Media.MEDIA_DURATION:c._duration=b;break;case Media.MEDIA_ERROR:c.errorCallback&&c.errorCallback(b);break;case Media.MEDIA_POSITION:c._position=Number(b);break;default:console.error&&console.error("Unhandled Media.onStatus :: "+a);break}}else{console.error&&console.error("Received Media.onStatus callback for unknown media :: "+d)}};module.exports=Media;