var MediaFile=require("cordova-plugin-media-capture.MediaFile");var MediaFileData=require("cordova-plugin-media-capture.MediaFileData");var CaptureError=require("cordova-plugin-media-capture.CaptureError");function dataURItoBlob(b){var f=atob(b.split(",")[1]);var a=b.split(",")[0].split(":")[1].split(";")[0];var e=new ArrayBuffer(f.length);var c=new Uint8Array(e);for(var d=0;d<f.length;d++){c[d]=f.charCodeAt(d)}return new Blob([e],{type:a})}function CameraUI(){var a=document.createElement("div");a.style.cssText="left: 0px; top: 0px; width: 100%; height: 100%; position: fixed; z-index:9999;padding: 40px; background-color: rgba(0,0,0,0.75);text-align:center; visibility: hidden";a.innerHTML='<div id="captureHint" style="height:100%; position:relative; display:inline-flex; align-content:flex-start;"><h2 style="position: absolute; width: 100%; background-color: rgba(255,255,255,0.25); margin: 0">Click on preview to capture image. Click outside of preview to cancel.</h1><video id="capturePreview" style="height: 100%"></video></div>';document.body.appendChild(a);var b=document.getElementById("capturePreview");b.autoplay=true;b.onplay=function(){a.style.visibility="visible"};this.container=a;this.preview=b}CameraUI.prototype.startPreview=function(d,b,a){this.preview.onclick=function(g){g.stopPropagation();var f=document.createElement("canvas");f.width=this.videoWidth;f.height=this.videoHeight;f.getContext("2d").drawImage(c.preview,0,0);b(f.toDataURL("image/jpeg"))};this.container.onclick=function(){a(new CaptureError(CaptureError.CAPTURE_NO_MEDIA_FILES))};var c=this;navigator.getUserMedia({video:true},function(e){c._previewStream=e;c.preview.src=URL.createObjectURL(e)},function(){a(new CaptureError(CaptureError.CAPTURE_INTERNAL_ERR))})};CameraUI.prototype.destroyPreview=function(){this.preview.pause();this.preview.src=null;this._previewStream.stop();this._previewStream=null;this.container&&document.body.removeChild(this.container)};module.exports={captureAudio:function(a,b){b&&b(new CaptureError(CaptureError.CAPTURE_NOT_SUPPORTED))},captureVideo:function(a,b){b&&b(new CaptureError(CaptureError.CAPTURE_NOT_SUPPORTED))},captureImage:function(a,d,f){var c=function(i){d&&d(new CaptureError(i||CaptureError.CAPTURE_INTERNAL_ERR))};var e=f[0];var b=e.limit||1;if(typeof b!=="number"||b<1){c(CaptureError.CAPTURE_INVALID_ARGUMENT);return}var h=0;navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;if(!navigator.getUserMedia){c(CaptureError.CAPTURE_NOT_SUPPORTED);return}var g=new CameraUI();g.startPreview(b,function(i){if(++h>=b){g.destroyPreview()}var j=[];window.requestFileSystem(window.TEMPORARY,i.length*b,function(k){var l=b<=1?"image.jpg":"image"+h+".jpg";k.root.getFile(l,{create:true},function(m){m.createWriter(function(n){n.onwriteend=function(){m.getMetadata(function(o){j.push(new MediaFile(m.name,m.toURL(),"image/jpeg",o.modificationTime,o.size));if(h>=b){a(j)}},c)};n.onerror=c;n.write(dataURItoBlob(i))})},c)},c)},function(i){g.destroyPreview();c(i.code)})},getFormatData:function(a,c,d){var b=document.createElement("img");b.src=d[0];b.onload=function(){a&&a(new MediaFileData(null,0,b.height,b.width,0))}}};require("cordova/exec/proxy").add("Capture",module.exports);