var argscheck=require("cordova/argscheck"),utils=require("cordova/utils"),exec=require("cordova/exec"),Acceleration=require("./Acceleration");var running=false;var timers={};var listeners=[];var accel=null;var eventTimerId=null;function start(){exec(function(c){var e=listeners.slice(0);accel=new Acceleration(c.x,c.y,c.z,c.timestamp);for(var d=0,b=e.length;d<b;d++){e[d].win(accel)}},function(d){var c=listeners.slice(0);for(var b=0,a=c.length;b<a;b++){c[b].fail(d)}},"Accelerometer","start",[]);running=true}function stop(){exec(null,null,"Accelerometer","stop",[]);accel=null;running=false}function createCallbackPair(b,a){return{win:b,fail:a}}function removeListeners(b){var a=listeners.indexOf(b);if(a>-1){listeners.splice(a,1);if(listeners.length===0){stop()}}}var accelerometer={getCurrentAcceleration:function(a,c,d){argscheck.checkArgs("fFO","accelerometer.getCurrentAcceleration",arguments);if(cordova.platformId==="windowsphone"){exec(function(g){accel=new Acceleration(g.x,g.y,g.z,g.timestamp);a(accel)},function(g){c(g)},"Accelerometer","getCurrentAcceleration",[]);return}var f;var e=function(g){removeListeners(f);a(g)};var b=function(g){removeListeners(f);if(c){c(g)}};f=createCallbackPair(e,b);listeners.push(f);if(!running){start()}},watchAcceleration:function(a,c,d){argscheck.checkArgs("fFO","accelerometer.watchAcceleration",arguments);var f=(d&&d.frequency&&typeof d.frequency=="number")?d.frequency:10000;var g=utils.createUUID();var e=createCallbackPair(function(){},function(h){removeListeners(e);if(c){c(h)}});listeners.push(e);timers[g]={timer:window.setInterval(function(){if(accel){a(accel)}},f),listeners:e};if(running){if(accel){a(accel)}}else{start()}if(cordova.platformId==="browser"&&!eventTimerId){var b=new Event("devicemotion");eventTimerId=window.setInterval(function(){window.dispatchEvent(b)},200)}return g},clearWatch:function(a){if(a&&timers[a]){window.clearInterval(timers[a].timer);removeListeners(timers[a].listeners);delete timers[a];if(eventTimerId&&Object.keys(timers).length===0){window.clearInterval(eventTimerId);eventTimerId=null}}}};module.exports=accelerometer;