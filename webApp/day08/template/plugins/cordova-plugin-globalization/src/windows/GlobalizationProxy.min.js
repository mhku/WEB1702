var GlobalizationError=require("./GlobalizationError");var locale=navigator.userLanguage||navigator.language;var decimalFormatter;var currencyFormatter;var percentFormatter;function createRoundingAlgorithm(){if(Windows.Globalization.NumberFormatting.IncrementNumberRounder){var a=new Windows.Globalization.NumberFormatting.IncrementNumberRounder();a.roundingAlgorithm=Windows.Globalization.NumberFormatting.RoundingAlgorithm.roundHalfUp;a.increment=0.01;return a}return null}function createDecimalFormatter(a){decimalFormatter=new Windows.Globalization.NumberFormatting.DecimalFormatter([locale],a);decimalFormatter.numberRounder=createRoundingAlgorithm();decimalFormatter.isGrouped=false;return decimalFormatter}function getDecimalFormatter(a){return decimalFormatter||createDecimalFormatter(a)}function createCurrencyFormatter(c){var b=new Windows.Globalization.GeographicRegion(c);var a=b.currenciesInUse[0];currencyFormatter=new Windows.Globalization.NumberFormatting.CurrencyFormatter(a,[locale],c);currencyFormatter.numberRounder=createRoundingAlgorithm();currencyFormatter.isGrouped=true;return currencyFormatter}function getCurrencyFormatter(a){return currencyFormatter||createCurrencyFormatter(a)}function createPercentFormatter(a){percentFormatter=new Windows.Globalization.NumberFormatting.PercentFormatter([locale],a);percentFormatter.numberRounder=createRoundingAlgorithm();percentFormatter.fractionDigits=0;percentFormatter.isGrouped=false;return percentFormatter}function getPercentFormatter(a){return percentFormatter||createPercentFormatter(a)}function getNumberFormatter(b){b=b||{type:"decimal"};b.type=b.type||"decimal";var a=locale.split("-");var c=a[a.length-1];switch(b.type){case"decimal":return getDecimalFormatter(c);case"currency":return getCurrencyFormatter(c);case"percent":return getPercentFormatter(c);default:throw"The options.type can be 'decimal', 'percent', or 'currency' only"}}module.exports={getPreferredLanguage:function(c,a){try{var d=Windows.System.UserProfile.GlobalizationPreferences.languages[0];c({value:d})}catch(b){a(b)}},getLocaleName:function(b,a){b({value:locale})},dateToString:function(c,a,b){tryDoAction(GlobalizationProxy.GlobalizationProxy.dateToString,JSON.stringify({date:b[0].date,options:b[0].options||{formatLength:"short",selector:"date and time"}}),c,a)},stringToDate:function(c,a,b){tryDoAction(GlobalizationProxy.GlobalizationProxy.stringToDate,JSON.stringify({dateString:b[0].dateString,options:b[0].options||{formatLength:"short",selector:"date and time"}}),c,a)},getDateNames:function(f,b,h){try{var o=h[0].options||{type:"wide",item:"months"};var j=o.type||"wide";var m=o.item||"months";var c=Windows.Globalization.DateTimeFormatting.MonthFormat.none;var k=Windows.Globalization.DateTimeFormatting.DayOfWeekFormat.none;if(m==="months"&&j==="wide"){c=Windows.Globalization.DateTimeFormatting.MonthFormat.full}else{if(m==="months"&&j==="narrow"){c=Windows.Globalization.DateTimeFormatting.MonthFormat.abbreviated}else{if(m==="days"&&j==="wide"){k=Windows.Globalization.DateTimeFormatting.DayOfWeekFormat.full}else{if(m==="days"&&j==="narrow"){k=Windows.Globalization.DateTimeFormatting.DayOfWeekFormat.abbreviated}else{throw"Incorrect item type"}}}}var l=new Windows.Globalization.DateTimeFormatting.DateTimeFormatter(Windows.Globalization.DateTimeFormatting.YearFormat.none,c,Windows.Globalization.DateTimeFormatting.DayFormat.none,k,Windows.Globalization.DateTimeFormatting.HourFormat.none,Windows.Globalization.DateTimeFormatting.MinuteFormat.none,Windows.Globalization.DateTimeFormatting.SecondFormat.none,[locale]);var n=[],d,a;if(m==="months"){for(d=0;d<12;d++){a=new Date(2014,d,20,0,0,0,0);n[d]=l.format(a)}}else{for(d=0;d<7;d++){a=new Date(2014,5,d+1,0,0,0,0);n[d]=l.format(a)}}f({value:n})}catch(g){b(new GlobalizationError(0,g))}},isDayLightSavingsTime:function(c,a,b){tryDoAction(GlobalizationProxy.GlobalizationProxy.isDayLightSavingsTime,JSON.stringify({date:b[0].date}),c,a)},getFirstDayOfWeek:function(b,a){b({value:Windows.System.UserProfile.GlobalizationPreferences.weekStartsOn+1})},numberToString:function(f,a,b){try{var c=getNumberFormatter(b[0].options);var g=c.format(b[0].number);if(!g){throw"Unknown error"}f({value:g})}catch(d){a(new GlobalizationError(GlobalizationError.FORMATTING_ERROR,d))}},stringToNumber:function(g,a,b){try{var c=getNumberFormatter(b[0].options);var d=c.parseDouble(b[0].numberString);if(!d){throw"Input string was in incorrect format"}g({value:d})}catch(f){a(new GlobalizationError(GlobalizationError.PARSING_ERROR,f))}},getDatePattern:function(c,a,b){tryDoAction(GlobalizationProxy.GlobalizationProxy.getDatePattern,JSON.stringify({options:b[0].options}),c,a)},getNumberPattern:function(h,b,c){try{var a=GlobalizationProxy.GlobalizationProxy.getNumberPattern(JSON.stringify({options:c[0].options}));var g=JSON.parse(a);checkForGlobalizationError(g);var d=getNumberFormatter(c[0].options);g.fraction=d.fractionDigits;h(g)}catch(f){b(f)}},getCurrencyPattern:function(h,b,d){try{var c=locale.split("-");var i=c[c.length-1];var a=d[0].currencyCode;var f=new Windows.Globalization.NumberFormatting.CurrencyFormatter(a,[locale],i);h({fraction:f.fractionDigits,code:f.currency,decimal:"",grouping:"",pattern:"",rounding:0})}catch(g){b(new GlobalizationError(GlobalizationError.PATTERN_ERROR,g))}}};function tryDoAction(d,c,h,b){try{var a=d(c);var g=JSON.parse(a);checkForGlobalizationError(g);h(g)}catch(f){b(f)}}function checkForGlobalizationError(a){if(a&&"code" in a&&"message" in a){throw new GlobalizationError(a.code,a.message)}}(function init(){GlobalizationProxy.GlobalizationProxy.setLocale(locale)})();require("cordova/exec/proxy").add("Globalization",module.exports);