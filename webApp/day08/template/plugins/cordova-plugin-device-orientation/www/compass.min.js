var argscheck=require("cordova/argscheck"),exec=require("cordova/exec"),utils=require("cordova/utils"),CompassHeading=require("./CompassHeading"),CompassError=require("./CompassError"),timers={},eventTimerId=null,compass={getCurrentHeading:function(a,c,d){argscheck.checkArgs("fFO","compass.getCurrentHeading",arguments);var e=function(f){var g=new CompassHeading(f.magneticHeading,f.trueHeading,f.headingAccuracy,f.timestamp);a(g)};var b=c&&function(f){var g=new CompassError(f);c(g)};exec(e,b,"Compass","getHeading",[d])},watchHeading:function(a,b,c){argscheck.checkArgs("fFO","compass.watchHeading",arguments);var f=(c!==undefined&&c.frequency!==undefined)?c.frequency:100;var d=(c!==undefined&&c.filter!==undefined)?c.filter:0;var g=utils.createUUID();if(d>0){timers[g]="iOS";compass.getCurrentHeading(a,b,c)}else{timers[g]=window.setInterval(function(){compass.getCurrentHeading(a,b)},f)}if(cordova.platformId==="browser"&&!eventTimerId){var e=new Event("deviceorientation");eventTimerId=window.setInterval(function(){window.dispatchEvent(e)},200)}return g},clearWatch:function(a){if(a&&timers[a]){if(timers[a]!="iOS"){clearInterval(timers[a])}else{exec(null,null,"Compass","stopHeading",[])}delete timers[a];if(eventTimerId&&Object.keys(timers).length===0){window.clearInterval(eventTimerId);eventTimerId=null}}}};module.exports=compass;