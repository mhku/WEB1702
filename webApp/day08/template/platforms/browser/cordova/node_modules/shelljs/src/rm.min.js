var common=require("./common");var fs=require("fs");function rmdirSyncRecursive(f,c){var a;a=fs.readdirSync(f);for(var h=0;h<a.length;h++){var d=f+"/"+a[h],g=fs.lstatSync(d);if(g.isDirectory()){rmdirSyncRecursive(d,c)}else{if(g.isSymbolicLink()){if(c||isWriteable(d)){try{common.unlinkSync(d)}catch(j){common.error("could not remove file (code "+j.code+"): "+d,true)}}}else{if(c||isWriteable(d)){try{common.unlinkSync(d)}catch(j){common.error("could not remove file (code "+j.code+"): "+d,true)}}}}}var l;try{var b=Date.now();while(true){try{l=fs.rmdirSync(f);if(fs.existsSync(f)){throw {code:"EAGAIN"}}break}catch(k){if(process.platform==="win32"&&(k.code==="ENOTEMPTY"||k.code==="EBUSY"||k.code==="EPERM"||k.code==="EAGAIN")){if(Date.now()-b>1000){throw k}}else{if(k.code==="ENOENT"){break}else{throw k}}}}}catch(j){common.error("could not remove directory (code "+j.code+"): "+f,true)}return l}function isWriteable(b){var a=true;try{var d=fs.openSync(b,"a");fs.closeSync(d)}catch(c){a=false}return a}function _rm(a,b){a=common.parseOptions(a,{f:"force",r:"recursive",R:"recursive"});if(!b){common.error("no paths given")}if(typeof b==="string"){b=[].slice.call(arguments,1)}b=common.expand(b);b.forEach(function(d){if(!fs.existsSync(d)){if(!a.force){common.error("no such file or directory: "+d,true)}return}var c=fs.lstatSync(d);if(c.isFile()||c.isSymbolicLink()){if(a.force){common.unlinkSync(d);return}if(isWriteable(d)){common.unlinkSync(d)}else{common.error("permission denied: "+d,true)}return}if(c.isDirectory()&&!a.recursive){common.error("path is a directory",true);return}if(c.isDirectory()&&a.recursive){rmdirSyncRecursive(d,a.force)}})}module.exports=_rm;