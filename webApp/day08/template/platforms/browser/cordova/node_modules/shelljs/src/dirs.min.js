var common=require("./common");var _cd=require("./cd");var path=require("path");var _dirStack=[];function _isStackIndex(a){return(/^[\-+]\d+$/).test(a)}function _parseStackIndex(a){if(_isStackIndex(a)){if(Math.abs(a)<_dirStack.length+1){return(/^-/).test(a)?Number(a)-1:Number(a)}else{common.error(a+": directory stack index out of range")}}else{common.error(a+": invalid number")}}function _actualDirStack(){return[process.cwd()].concat(_dirStack)}function _pushd(b,a){if(_isStackIndex(b)){a=b;b=""}b=common.parseOptions(b,{n:"no-cd"});var c=_actualDirStack();if(a==="+0"){return c}else{if(!a){if(c.length>1){c=c.splice(1,1).concat(c)}else{return common.error("no other directory")}}else{if(_isStackIndex(a)){var d=_parseStackIndex(a);c=c.slice(d).concat(c.slice(0,d))}else{if(b["no-cd"]){c.splice(1,0,a)}else{c.unshift(a)}}}}if(b["no-cd"]){c=c.slice(1)}else{a=path.resolve(c.shift());_cd("",a)}_dirStack=c;return _dirs("")}exports.pushd=_pushd;function _popd(c,b){if(_isStackIndex(c)){b=c;c=""}c=common.parseOptions(c,{n:"no-cd"});if(!_dirStack.length){return common.error("directory stack empty")}b=_parseStackIndex(b||"+0");if(c["no-cd"]||b>0||_dirStack.length+b===0){b=b>0?b-1:b;_dirStack.splice(b,1)}else{var a=path.resolve(_dirStack.shift());_cd("",a)}return _dirs("")}exports.popd=_popd;function _dirs(c,b){if(_isStackIndex(c)){b=c;c=""}c=common.parseOptions(c,{c:"clear"});if(c.clear){_dirStack=[];return _dirStack}var a=_actualDirStack();if(b){b=_parseStackIndex(b);if(b<0){b=a.length+b}common.log(a[b]);return a[b]}common.log(a.join(" "));return a}exports.dirs=_dirs;