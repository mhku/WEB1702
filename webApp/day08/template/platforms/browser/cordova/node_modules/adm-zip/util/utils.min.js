var fs=require("fs"),pth=require("path");fs.existsSync=fs.existsSync||pth.existsSync;module.exports=(function(){var b=[],d=require("./constants"),f=require("./errors"),a=pth.normalize("/");function c(h){var g=h.split(a)[0];h.split(a).forEach(function(i){if(!i||i.substr(-1,1)==":"){return}g+=a+i;var j;try{j=fs.statSync(g)}catch(k){fs.mkdirSync(g)}if(j&&j.isFile()){throw f.FILE_IN_THE_WAY.replace("%s",g)}})}function e(g,i,j){if(typeof i==="boolean"){j=i;i=undefined}var h=[];fs.readdirSync(g).forEach(function(k){var l=pth.join(g,k);if(fs.statSync(l).isDirectory()&&j){h=h.concat(e(l,i,j))}if(!i||i.test(l)){h.push(pth.normalize(l)+(fs.statSync(l).isDirectory()?a:""))}});return h}return{makeDir:function(g){c(g)},crc32:function(g){var q=new Buffer(4);if(!b.length){for(var h=0;h<256;h++){var p=h;for(var j=8;--j>=0;){if((p&1)!=0){p=3988292384^(p>>>1)}else{p=p>>>1}}if(p<0){q.writeInt32LE(p,0);p=q.readUInt32LE(0)}b[h]=p}}var m=0,i=0,o=g.length,l=~m;while(--o>=0){l=b[(l^g[i++])&255]^(l>>>8)}m=~l;q.writeInt32LE(m&4294967295,0);return q.readUInt32LE(0)},methodToString:function(g){switch(g){case d.STORED:return"STORED ("+g+")";case d.DEFLATED:return"DEFLATED ("+g+")";default:return"UNSUPPORTED ("+g+")"}},writeFileTo:function(n,l,h,g){if(fs.existsSync(n)){if(!h){return false}var j=fs.statSync(n);if(j.isDirectory()){return false}}var k=pth.dirname(n);if(!fs.existsSync(k)){c(k)}var i;try{i=fs.openSync(n,"w",438)}catch(m){fs.chmodSync(n,438);i=fs.openSync(n,"w",438)}if(i){fs.writeSync(i,l,0,l.length,0);fs.closeSync(i)}fs.chmodSync(n,g||438);return true},writeFileToAsync:function(j,i,h,g,k){if(typeof g==="function"){k=g;g=undefined}fs.exists(j,function(l){if(l&&!h){return k(false)}fs.stat(j,function(o,m){if(l&&m.isDirectory()){return k(false)}var n=pth.dirname(j);fs.exists(n,function(p){if(!p){c(n)}fs.open(j,"w",438,function(r,q){if(r){fs.chmod(j,438,function(s){fs.open(j,"w",438,function(u,t){fs.write(t,i,0,i.length,0,function(x,w,v){fs.close(t,function(y){fs.chmod(j,g||438,function(){k(true)})})})})})}else{if(q){fs.write(q,i,0,i.length,0,function(u,t,s){fs.close(q,function(v){fs.chmod(j,g||438,function(){k(true)})})})}else{fs.chmod(j,g||438,function(){k(true)})}}})})})})},findFiles:function(g){return e(g,true)},getAttributes:function(g){},setAttributes:function(g){},toBuffer:function(g){if(Buffer.isBuffer(g)){return g}else{if(g.length==0){return new Buffer(0)}return new Buffer(g,"utf8")}},Constants:d,Errors:f}})();