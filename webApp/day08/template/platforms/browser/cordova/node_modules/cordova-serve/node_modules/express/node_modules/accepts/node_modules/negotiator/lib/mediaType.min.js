module.exports=preferredMediaTypes;preferredMediaTypes.preferredMediaTypes=preferredMediaTypes;function parseAccept(e){var d=splitMediaTypes(e);for(var c=0,b=0;c<d.length;c++){var a=parseMediaType(d[c].trim(),c);if(a){d[b++]=a}}d.length=b;return d}function parseMediaType(f,d){var b=f.match(/\s*(\S+?)\/([^;\s]+)\s*(?:;(.*))?/);if(!b){return null}var e=b[1],a=b[2],c=""+e+"/"+a,h={},g=1;if(b[3]){h=b[3].split(";").map(function(i){return i.trim().split("=")}).reduce(function(l,k){var i=k[0].toLowerCase();var j=k[1];l[i]=j&&j[0]==='"'&&j[j.length-1]==='"'?j.substr(1,j.length-2):j;return l},h);if(h.q!=null){g=parseFloat(h.q);delete h.q}}return{type:e,subtype:a,params:h,q:g,i:d,full:c}}function getMediaTypePriority(e,f,b){var d={o:-1,q:0,s:0};for(var c=0;c<f.length;c++){var a=specify(e,f[c],b);if(a&&(d.s-a.s||d.q-a.q||d.o-a.o)<0){d=a}}return d}function specify(d,a,b){var f=parseMediaType(d);var c=0;if(!f){return null}if(a.type.toLowerCase()==f.type.toLowerCase()){c|=4}else{if(a.type!="*"){return null}}if(a.subtype.toLowerCase()==f.subtype.toLowerCase()){c|=2}else{if(a.subtype!="*"){return null}}var e=Object.keys(a.params);if(e.length>0){if(e.every(function(g){return a.params[g]=="*"||(a.params[g]||"").toLowerCase()==(f.params[g]||"").toLowerCase()})){c|=1}else{return null}}return{i:b,o:a.i,q:a.q,s:c}}function preferredMediaTypes(d,a){var c=parseAccept(d===undefined?"*/*":d||"");if(!a){return c.filter(isQuality).sort(compareSpecs).map(function e(g){return g.full})}var b=a.map(function f(h,g){return getMediaTypePriority(h,c,g)});return b.filter(isQuality).sort(compareSpecs).map(function e(g){return a[b.indexOf(g)]})}function compareSpecs(d,c){return(c.q-d.q)||(c.s-d.s)||(d.o-c.o)||(d.i-c.i)||0}function isQuality(a){return a.q>0}function quoteCount(b){var c=0;var a=0;while((a=b.indexOf('"',a))!==-1){c++;a++}return c}function splitMediaTypes(d){var c=d.split(",");for(var b=1,a=0;b<c.length;b++){if(quoteCount(c[a])%2==0){c[++a]=c[b]}else{c[a]+=","+c[b]}}c.length=a+1;return c};