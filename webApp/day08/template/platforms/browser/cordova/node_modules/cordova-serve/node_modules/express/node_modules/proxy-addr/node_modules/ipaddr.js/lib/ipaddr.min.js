(function(){var d,f,b,h,c,g,e,a;f={};a=this;if((typeof module!=="undefined"&&module!==null)&&module.exports){module.exports=f}else{a.ipaddr=f}e=function(n,m,l,k){var j,i;if(n.length!==m.length){throw new Error("ipaddr: cannot match CIDR for objects with different lengths")}j=0;while(k>0){i=l-k;if(i<0){i=0}if(n[j]>>i!==m[j]>>i){return false}k-=l;j+=1}return true};f.subnetMatch=function(k,j,p){var o,l,m,n,i;if(p==null){p="unicast"}for(o in j){l=j[o];if(l[0]&&!(l[0] instanceof Array)){l=[l]}for(n=0,i=l.length;n<i;n++){m=l[n];if(k.match.apply(k,m)){return o}}}return p};f.IPv4=(function(){function i(l){var k,m,j;if(l.length!==4){throw new Error("ipaddr: ipv4 octet count should be 4")}for(m=0,j=l.length;m<j;m++){k=l[m];if(!((0<=k&&k<=255))){throw new Error("ipaddr: ipv4 octet is a byte")}}this.octets=l}i.prototype.kind=function(){return"ipv4"};i.prototype.toString=function(){return this.octets.join(".")};i.prototype.toByteArray=function(){return this.octets.slice(0)};i.prototype.match=function(j,k){var l;if(k===void 0){l=j,j=l[0],k=l[1]}if(j.kind()!=="ipv4"){throw new Error("ipaddr: cannot match ipv4 address with non-ipv4 one")}return e(this.octets,j.octets,8,k)};i.prototype.SpecialRanges={unspecified:[[new i([0,0,0,0]),8]],broadcast:[[new i([255,255,255,255]),32]],multicast:[[new i([224,0,0,0]),4]],linkLocal:[[new i([169,254,0,0]),16]],loopback:[[new i([127,0,0,0]),8]],"private":[[new i([10,0,0,0]),8],[new i([172,16,0,0]),12],[new i([192,168,0,0]),16]],reserved:[[new i([192,0,0,0]),24],[new i([192,0,2,0]),24],[new i([192,88,99,0]),24],[new i([198,51,100,0]),24],[new i([203,0,113,0]),24],[new i([240,0,0,0]),4]]};i.prototype.range=function(){return f.subnetMatch(this,this.SpecialRanges)};i.prototype.toIPv4MappedAddress=function(){return f.IPv6.parse("::ffff:"+(this.toString()))};return i})();b="(0?\\d+|0x[a-f0-9]+)";h={fourOctet:new RegExp("^"+b+"\\."+b+"\\."+b+"\\."+b+"$","i"),longValue:new RegExp("^"+b+"$","i")};f.IPv4.parser=function(l){var k,n,j,i,m;n=function(o){if(o[0]==="0"&&o[1]!=="x"){return parseInt(o,8)}else{return parseInt(o)}};if(k=l.match(h.fourOctet)){return(function(){var r,p,q,o;q=k.slice(1,6);o=[];for(r=0,p=q.length;r<p;r++){j=q[r];o.push(n(j))}return o})()}else{if(k=l.match(h.longValue)){m=n(k[1]);if(m>4294967295||m<0){throw new Error("ipaddr: address outside defined range")}return((function(){var p,o;o=[];for(i=p=0;p<=24;i=p+=8){o.push((m>>i)&255)}return o})()).reverse()}else{return null}}};f.IPv6=(function(){function i(m){var k,l,j;if(m.length!==8){throw new Error("ipaddr: ipv6 part count should be 8")}for(l=0,j=m.length;l<j;l++){k=m[l];if(!((0<=k&&k<=65535))){throw new Error("ipaddr: ipv6 part should fit to two octets")}}this.parts=m}i.prototype.kind=function(){return"ipv6"};i.prototype.toString=function(){var l,m,p,o,k,n,j;k=(function(){var t,r,s,q;s=this.parts;q=[];for(t=0,r=s.length;t<r;t++){m=s[t];q.push(m.toString(16))}return q}).call(this);l=[];p=function(q){return l.push(q)};o=0;for(n=0,j=k.length;n<j;n++){m=k[n];switch(o){case 0:if(m==="0"){p("")}else{p(m)}o=1;break;case 1:if(m==="0"){o=2}else{p(m)}break;case 2:if(m!=="0"){p("");p(m);o=3}break;case 3:p(m)}}if(o===2){p("");p("")}return l.join(":")};i.prototype.toByteArray=function(){var k,l,n,j,m;k=[];m=this.parts;for(n=0,j=m.length;n<j;n++){l=m[n];k.push(l>>8);k.push(l&255)}return k};i.prototype.toNormalizedString=function(){var j;return((function(){var n,l,m,k;m=this.parts;k=[];for(n=0,l=m.length;n<l;n++){j=m[n];k.push(j.toString(16))}return k}).call(this)).join(":")};i.prototype.match=function(j,k){var l;if(k===void 0){l=j,j=l[0],k=l[1]}if(j.kind()!=="ipv6"){throw new Error("ipaddr: cannot match ipv6 address with non-ipv6 one")}return e(this.parts,j.parts,16,k)};i.prototype.SpecialRanges={unspecified:[new i([0,0,0,0,0,0,0,0]),128],linkLocal:[new i([65152,0,0,0,0,0,0,0]),10],multicast:[new i([65280,0,0,0,0,0,0,0]),8],loopback:[new i([0,0,0,0,0,0,0,1]),128],uniqueLocal:[new i([64512,0,0,0,0,0,0,0]),7],ipv4Mapped:[new i([0,0,0,0,0,65535,0,0]),96],rfc6145:[new i([0,0,0,0,65535,0,0,0]),96],rfc6052:[new i([100,65435,0,0,0,0,0,0]),96],"6to4":[new i([8194,0,0,0,0,0,0,0]),16],teredo:[new i([8193,0,0,0,0,0,0,0]),32],reserved:[[new i([8193,3512,0,0,0,0,0,0]),32]]};i.prototype.range=function(){return f.subnetMatch(this,this.SpecialRanges)};i.prototype.isIPv4MappedAddress=function(){return this.range()==="ipv4Mapped"};i.prototype.toIPv4Address=function(){var l,j,k;if(!this.isIPv4MappedAddress()){throw new Error("ipaddr: trying to convert a generic ipv6 address to ipv4")}k=this.parts.slice(-2),l=k[0],j=k[1];return new f.IPv4([l>>8,l&255,j>>8,j&255])};return i})();c="(?:[0-9a-f]+::?)+";g={"native":new RegExp("^(::)?("+c+")?([0-9a-f]+)?(::)?$","i"),transitional:new RegExp(("^((?:"+c+")|(?:::)(?:"+c+")?)")+(""+b+"\\."+b+"\\."+b+"\\."+b+"$"),"i")};d=function(k,o){var n,i,j,m,l;if(k.indexOf("::")!==k.lastIndexOf("::")){return null}n=0;i=-1;while((i=k.indexOf(":",i+1))>=0){n++}if(k.substr(0,2)==="::"){n--}if(k.substr(-2,2)==="::"){n--}if(n>o){return null}l=o-n;m=":";while(l--){m+="0:"}k=k.replace("::",m);if(k[0]===":"){k=k.slice(1)}if(k[k.length-1]===":"){k=k.slice(0,-1)}return(function(){var s,q,r,p;r=k.split(":");p=[];for(s=0,q=r.length;s<q;s++){j=r[s];p.push(parseInt(j,16))}return p})()};f.IPv6.parser=function(j){var i,k;if(j.match(g["native"])){return d(j,8)}else{if(i=j.match(g.transitional)){k=d(i[1].slice(0,-1),6);if(k){k.push(parseInt(i[2])<<8|parseInt(i[3]));k.push(parseInt(i[4])<<8|parseInt(i[5]));return k}}}return null};f.IPv4.isIPv4=f.IPv6.isIPv6=function(i){return this.parser(i)!==null};f.IPv4.isValid=function(i){var j;try{new this(this.parser(i));return true}catch(k){j=k;return false}};f.IPv6.isValid=function(i){var j;if(typeof i==="string"&&i.indexOf(":")===-1){return false}try{new this(this.parser(i));return true}catch(k){j=k;return false}};f.IPv4.parse=f.IPv6.parse=function(i){var j;j=this.parser(i);if(j===null){throw new Error("ipaddr: string is not formatted like ip address")}return new this(j)};f.IPv4.parseCIDR=function(j){var k,i;if(i=j.match(/^(.+)\/(\d+)$/)){k=parseInt(i[2]);if(k>=0&&k<=32){return[this.parse(i[1]),k]}}throw new Error("ipaddr: string is not formatted like an IPv4 CIDR range")};f.IPv6.parseCIDR=function(j){var k,i;if(i=j.match(/^(.+)\/(\d+)$/)){k=parseInt(i[2]);if(k>=0&&k<=128){return[this.parse(i[1]),k]}}throw new Error("ipaddr: string is not formatted like an IPv6 CIDR range")};f.isValid=function(i){return f.IPv6.isValid(i)||f.IPv4.isValid(i)};f.parse=function(i){if(f.IPv6.isValid(i)){return f.IPv6.parse(i)}else{if(f.IPv4.isValid(i)){return f.IPv4.parse(i)}else{throw new Error("ipaddr: the address has neither IPv6 nor IPv4 format")}}};f.parseCIDR=function(i){var j;try{return f.IPv6.parseCIDR(i)}catch(k){j=k;try{return f.IPv4.parseCIDR(i)}catch(k){j=k;throw new Error("ipaddr: the address has neither IPv6 nor IPv4 CIDR format")}}};f.process=function(i){var j;j=this.parse(i);if(j.kind()==="ipv6"&&j.isIPv4MappedAddress()){return j.toIPv4Address()}else{return j}}}).call(this);