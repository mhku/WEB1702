var Utils=require("./utils");var internals={delimiter:"&",depth:5,arrayLimit:20,parameterLimit:1000,strictNullHandling:false,plainObjects:false,allowPrototypes:false};internals.parseValues=function(f,k){var d={};var c=f.split(k.delimiter,k.parameterLimit===Infinity?undefined:k.parameterLimit);for(var e=0,h=c.length;e<h;++e){var a=c[e];var g=a.indexOf("]=")===-1?a.indexOf("="):a.indexOf("]=")+1;if(g===-1){d[Utils.decode(a)]="";if(k.strictNullHandling){d[Utils.decode(a)]=null}}else{var j=Utils.decode(a.slice(0,g));var b=Utils.decode(a.slice(g+1));if(!Object.prototype.hasOwnProperty.call(d,j)){d[j]=b}else{d[j]=[].concat(d[j]).concat(b)}}}return d};internals.parseObject=function(f,h,e){if(!f.length){return h}var a=f.shift();var g;if(a==="[]"){g=[];g=g.concat(internals.parseObject(f,h,e))}else{g=e.plainObjects?Object.create(null):{};var d=a[0]==="["&&a[a.length-1]==="]"?a.slice(1,a.length-1):a;var c=parseInt(d,10);var b=""+c;if(!isNaN(c)&&a!==d&&b===d&&c>=0&&(e.parseArrays&&c<=e.arrayLimit)){g=[];g[c]=internals.parseObject(f,h,e)}else{g[d]=internals.parseObject(f,h,e)}}return g};internals.parseKeys=function(c,g,a){if(!c){return}if(a.allowDots){c=c.replace(/\.([^\.\[]+)/g,"[$1]")}var d=/^([^\[\]]*)/;var h=/(\[[^\[\]]*\])/g;var f=d.exec(c);var e=[];if(f[1]){if(!a.plainObjects&&Object.prototype.hasOwnProperty(f[1])){if(!a.allowPrototypes){return}}e.push(f[1])}var b=0;while((f=h.exec(c))!==null&&b<a.depth){++b;if(!a.plainObjects&&Object.prototype.hasOwnProperty(f[1].replace(/\[|\]/g,""))){if(!a.allowPrototypes){continue}}e.push(f[1])}if(f){e.push("["+c.slice(f.index)+"]")}return internals.parseObject(e,g,a)};module.exports=function(d,j){j=j||{};j.delimiter=typeof j.delimiter==="string"||Utils.isRegExp(j.delimiter)?j.delimiter:internals.delimiter;j.depth=typeof j.depth==="number"?j.depth:internals.depth;j.arrayLimit=typeof j.arrayLimit==="number"?j.arrayLimit:internals.arrayLimit;j.parseArrays=j.parseArrays!==false;j.allowDots=j.allowDots!==false;j.plainObjects=typeof j.plainObjects==="boolean"?j.plainObjects:internals.plainObjects;j.allowPrototypes=typeof j.allowPrototypes==="boolean"?j.allowPrototypes:internals.allowPrototypes;j.parameterLimit=typeof j.parameterLimit==="number"?j.parameterLimit:internals.parameterLimit;j.strictNullHandling=typeof j.strictNullHandling==="boolean"?j.strictNullHandling:internals.strictNullHandling;if(d===""||d===null||typeof d==="undefined"){return j.plainObjects?Object.create(null):{}}var e=typeof d==="string"?internals.parseValues(d,j):d;var b=j.plainObjects?Object.create(null):{};var h=Object.keys(e);for(var c=0,f=h.length;c<f;++c){var g=h[c];var a=internals.parseKeys(g,e[g],j);b=Utils.merge(b,a,j)}return Utils.compact(b)};