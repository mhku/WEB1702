(function(){var g,d,k,h,c,j,b,f;d={},f=this,"undefined"!=typeof module&&null!==module&&module.exports?module.exports=d:f.ipaddr=d,b=function(m,l,s,p){var a,q;if(m.length!==l.length){throw new Error("ipaddr: cannot match CIDR for objects with different lengths")}for(a=0;p>0;){if(q=s-p,0>q&&(q=0),m[a]>>q!==l[a]>>q){return !1}p-=s,a+=1}return !0},d.subnetMatch=function(u,p,x){var v,m,w,l,q;null==x&&(x="unicast");for(v in p){for(m=p[v],!m[0]||m[0] instanceof Array||(m=[m]),l=0,q=m.length;q>l;l++){if(w=m[l],u.match.apply(u,w)){return v}}}return x},d.IPv4=function(){function a(l){var i,o,m;if(4!==l.length){throw new Error("ipaddr: ipv4 octet count should be 4")}for(o=0,m=l.length;m>o;o++){if(i=l[o],!(i>=0&&255>=i)){throw new Error("ipaddr: ipv4 octet is a byte")}}this.octets=l}return a.prototype.kind=function(){return"ipv4"},a.prototype.toString=function(){return this.octets.join(".")},a.prototype.toByteArray=function(){return this.octets.slice(0)},a.prototype.match=function(i,e){var l;if(void 0===e&&(l=i,i=l[0],e=l[1]),"ipv4"!==i.kind()){throw new Error("ipaddr: cannot match ipv4 address with non-ipv4 one")}return b(this.octets,i.octets,8,e)},a.prototype.SpecialRanges={unspecified:[[new a([0,0,0,0]),8]],broadcast:[[new a([255,255,255,255]),32]],multicast:[[new a([224,0,0,0]),4]],linkLocal:[[new a([169,254,0,0]),16]],loopback:[[new a([127,0,0,0]),8]],"private":[[new a([10,0,0,0]),8],[new a([172,16,0,0]),12],[new a([192,168,0,0]),16]],reserved:[[new a([192,0,0,0]),24],[new a([192,0,2,0]),24],[new a([192,88,99,0]),24],[new a([198,51,100,0]),24],[new a([203,0,113,0]),24],[new a([240,0,0,0]),4]]},a.prototype.range=function(){return d.subnetMatch(this,this.SpecialRanges)},a.prototype.toIPv4MappedAddress=function(){return d.IPv6.parse("::ffff:"+this.toString())},a}(),k="(0?\\d+|0x[a-f0-9]+)",h={fourOctet:new RegExp("^"+k+"\\."+k+"\\."+k+"\\."+k+"$","i"),longValue:new RegExp("^"+k+"$","i")},d.IPv4.parser=function(p){var m,s,l,q,e;if(s=function(a){return"0"===a[0]&&"x"!==a[1]?parseInt(a,8):parseInt(a)},m=p.match(h.fourOctet)){return function(){var n,t,u,i;for(u=m.slice(1,6),i=[],n=0,t=u.length;t>n;n++){l=u[n],i.push(s(l))}return i}()}if(m=p.match(h.longValue)){if(e=s(m[1]),e>4294967295||0>e){throw new Error("ipaddr: address outside defined range")}return function(){var i,a;for(a=[],q=i=0;24>=i;q=i+=8){a.push(e>>q&255)}return a}().reverse()}return null},d.IPv6=function(){function a(l){var i,o,m;if(8!==l.length){throw new Error("ipaddr: ipv6 part count should be 8")}for(o=0,m=l.length;m>o;o++){if(i=l[o],!(i>=0&&65535>=i)){throw new Error("ipaddr: ipv6 part should fit to two octets")}}this.parts=l}return a.prototype.kind=function(){return"ipv6"},a.prototype.toString=function(){var q,p,v,s,m,u,l;for(m=function(){var t,x,w,o;for(w=this.parts,o=[],t=0,x=w.length;x>t;t++){p=w[t],o.push(p.toString(16))}return o}.call(this),q=[],v=function(e){return q.push(e)},s=0,u=0,l=m.length;l>u;u++){switch(p=m[u],s){case 0:v("0"===p?"":p),s=1;break;case 1:"0"===p?s=2:v(p);break;case 2:"0"!==p&&(v(""),v(p),s=3);break;case 3:v(p)}}return 2===s&&(v(""),v("")),q.join(":")},a.prototype.toByteArray=function(){var o,m,q,p,l;for(o=[],l=this.parts,q=0,p=l.length;p>q;q++){m=l[q],o.push(m>>8),o.push(255&m)}return o},a.prototype.toNormalizedString=function(){var e;return function(){var m,p,o,l;for(o=this.parts,l=[],m=0,p=o.length;p>m;m++){e=o[m],l.push(e.toString(16))}return l}.call(this).join(":")},a.prototype.match=function(i,e){var l;if(void 0===e&&(l=i,i=l[0],e=l[1]),"ipv6"!==i.kind()){throw new Error("ipaddr: cannot match ipv6 address with non-ipv6 one")}return b(this.parts,i.parts,16,e)},a.prototype.SpecialRanges={unspecified:[new a([0,0,0,0,0,0,0,0]),128],linkLocal:[new a([65152,0,0,0,0,0,0,0]),10],multicast:[new a([65280,0,0,0,0,0,0,0]),8],loopback:[new a([0,0,0,0,0,0,0,1]),128],uniqueLocal:[new a([64512,0,0,0,0,0,0,0]),7],ipv4Mapped:[new a([0,0,0,0,0,65535,0,0]),96],rfc6145:[new a([0,0,0,0,65535,0,0,0]),96],rfc6052:[new a([100,65435,0,0,0,0,0,0]),96],"6to4":[new a([8194,0,0,0,0,0,0,0]),16],teredo:[new a([8193,0,0,0,0,0,0,0]),32],reserved:[[new a([8193,3512,0,0,0,0,0,0]),32]]},a.prototype.range=function(){return d.subnetMatch(this,this.SpecialRanges)},a.prototype.isIPv4MappedAddress=function(){return"ipv4Mapped"===this.range()},a.prototype.toIPv4Address=function(){var i,m,l;if(!this.isIPv4MappedAddress()){throw new Error("ipaddr: trying to convert a generic ipv6 address to ipv4")}return l=this.parts.slice(-2),i=l[0],m=l[1],new d.IPv4([i>>8,255&i,m>>8,255&m])},a}(),c="(?:[0-9a-f]+::?)+",j={"native":new RegExp("^(::)?("+c+")?([0-9a-f]+)?(::)?$","i"),transitional:new RegExp("^((?:"+c+")|(?:::)(?:"+c+")?)"+(""+k+"\\."+k+"\\."+k+"\\."+k+"$"),"i")},g=function(q,p){var v,s,m,u,l;if(q.indexOf("::")!==q.lastIndexOf("::")){return null}for(v=0,s=-1;(s=q.indexOf(":",s+1))>=0;){v++}if("::"===q.substr(0,2)&&v--,"::"===q.substr(-2,2)&&v--,v>p){return null}for(l=p-v,u=":";l--;){u+="0:"}return q=q.replace("::",u),":"===q[0]&&(q=q.slice(1)),":"===q[q.length-1]&&(q=q.slice(0,-1)),function(){var a,w,i,r;for(i=q.split(":"),r=[],a=0,w=i.length;w>a;a++){m=i[a],r.push(parseInt(m,16))}return r}()},d.IPv6.parser=function(a){var l,i;return a.match(j["native"])?g(a,8):(l=a.match(j.transitional))&&(i=g(l[1].slice(0,-1),6))?(i.push(parseInt(l[2])<<8|parseInt(l[3])),i.push(parseInt(l[4])<<8|parseInt(l[5])),i):null},d.IPv4.isIPv4=d.IPv6.isIPv6=function(a){return null!==this.parser(a)},d.IPv4.isValid=function(e){var a;try{return new this(this.parser(e)),!0}catch(i){return a=i,!1}},d.IPv6.isValid=function(e){var a;if("string"==typeof e&&-1===e.indexOf(":")){return !1}try{return new this(this.parser(e)),!0}catch(i){return a=i,!1}},d.IPv4.parse=d.IPv6.parse=function(e){var a;if(a=this.parser(e),null===a){throw new Error("ipaddr: string is not formatted like ip address")}return new this(a)},d.IPv4.parseCIDR=function(e){var a,i;if((i=e.match(/^(.+)\/(\d+)$/))&&(a=parseInt(i[2]),a>=0&&32>=a)){return[this.parse(i[1]),a]}throw new Error("ipaddr: string is not formatted like an IPv4 CIDR range")},d.IPv6.parseCIDR=function(e){var a,i;if((i=e.match(/^(.+)\/(\d+)$/))&&(a=parseInt(i[2]),a>=0&&128>=a)){return[this.parse(i[1]),a]}throw new Error("ipaddr: string is not formatted like an IPv6 CIDR range")},d.isValid=function(a){return d.IPv6.isValid(a)||d.IPv4.isValid(a)},d.parse=function(a){if(d.IPv6.isValid(a)){return d.IPv6.parse(a)}if(d.IPv4.isValid(a)){return d.IPv4.parse(a)}throw new Error("ipaddr: the address has neither IPv6 nor IPv4 format")},d.parseCIDR=function(a){var l;try{return d.IPv6.parseCIDR(a)}catch(i){l=i;try{return d.IPv4.parseCIDR(a)}catch(i){throw l=i,new Error("ipaddr: the address has neither IPv6 nor IPv4 CIDR format")}}},d.process=function(e){var a;return a=this.parse(e),"ipv6"===a.kind()&&a.isIPv4MappedAddress()?a.toIPv4Address():a}}).call(this);