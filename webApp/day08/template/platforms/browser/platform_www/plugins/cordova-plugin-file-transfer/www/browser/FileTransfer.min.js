cordova.define("cordova-plugin-file-transfer.BrowserFileTransfer",function(c,e,a){var m=c("cordova/argscheck"),f=c("./FileTransferError");function i(n){var o=n.lastIndexOf("/");return n.substring(0,o+1)}function k(n){var o=n.lastIndexOf("/");return n.substring(o+1)}function l(p){var o=/^https?\:\/\/(?:(?:(([^:@\/]*)(?::([^@\/]*))?)?@)?([^:\/?#]*)(?::(\d*))?).*$/,n=o.exec(p);return n&&n[1]}function d(q){var r=null;if(window.btoa){var p=l(q);if(p){var o="Authorization";var n="Basic "+window.btoa(p);r={name:o,value:n}}}return r}function h(n){return n.indexOf(" ")===-1?true:false}var b=0;var j={};var g=function(){this._id=++b;this.onprogress=null};g.prototype.upload=function(t,s,p,y,C){m.checkArgs("ssFFO*","FileTransfer.upload",arguments);if(!h(s)){if(y){y(new f(f.INVALID_URL_ERR,t,s))}return}C=C||{};var A=C.fileKey||"file";var w=C.fileName||"image.jpg";var o=C.mimeType||"image/jpeg";var v=C.params||{};var u=C.withCredentials||false;var q=C.headers||{};var n=C.httpMethod&&C.httpMethod.toUpperCase()==="PUT"?"PUT":"POST";var x=d(s);if(x){s=s.replace(l(s)+"@","");q[x.name]=x.value}var z=this;var B=j[this._id]=new XMLHttpRequest();B.withCredentials=u;var r=y&&function(G,D,E){if(j[this._id]){delete j[this._id]}var F=new f(G,t,s,D,E);if(y){y(F)}};window.resolveLocalFileSystemURL(t,function(D){D.file(function(F){var E=new FileReader();E.onloadend=function(){var G=new Blob([this.result],{type:o});var H=new FormData();H.append(A,G,w);for(var J in v){if(v.hasOwnProperty(J)){H.append(J,v[J])}}B.open(n,s);for(var I in q){if(q.hasOwnProperty(I)){B.setRequestHeader(I,q[I])}}B.onload=function(){if(this.status===200){var K=new FileUploadResult();K.bytesSent=G.size;K.responseCode=this.status;K.response=this.response;delete j[z._id];p(K)}else{if(this.status===404){r(f.INVALID_URL_ERR,this.status,this.response)}else{r(f.CONNECTION_ERR,this.status,this.response)}}};B.ontimeout=function(){r(f.CONNECTION_ERR,this.status,this.response)};B.onerror=function(){r(f.CONNECTION_ERR,this.status,this.response)};B.onabort=function(){r(f.ABORT_ERR,this.status,this.response)};B.upload.onprogress=function(K){if(z.onprogress){z.onprogress(K)}};B.send(H);if(!j[z._id]){B.abort()}};E.readAsArrayBuffer(F)},function(){r(f.FILE_NOT_FOUND_ERR)})},function(){r(f.FILE_NOT_FOUND_ERR)})};g.prototype.download=function(n,x,o,v,u,z){m.checkArgs("ssFF*","FileTransfer.download",arguments);if(!h(n)){if(v){v(new f(f.INVALID_URL_ERR,n,x))}return}z=z||{};var p=z.headers||{};var r=z.withCredentials||false;var s=d(n);if(s){n=n.replace(l(n)+"@","");p[s.name]=s.value}var w=this;var y=j[this._id]=new XMLHttpRequest();y.withCredentials=r;var q=v&&function(E,B,C){if(j[w._id]){delete j[w._id]}if(C instanceof Blob){var A=new FileReader();A.readAsText(C);A.onloadend=function(G){var F=new f(E,n,x,B,G.target.result);v(F)}}else{var D=new f(E,n,x,B,C);v(D)}};y.onload=function(C){var A=function(){q(f.FILE_NOT_FOUND_ERR)};var B=C.target;if((B.status===200||B.status===0)&&B.response){window.resolveLocalFileSystemURL(i(x),function(D){D.getFile(k(x),{create:true},function E(F){F.createWriter(function(G){G.onwriteend=function(H){if(!H.target.error){F.filesystemName=F.filesystem.name;delete j[w._id];if(o){o(F)}}else{q(f.FILE_NOT_FOUND_ERR)}};G.onerror=function(){q(f.FILE_NOT_FOUND_ERR)};G.write(B.response)},A)},A)},A)}else{if(B.status===404){q(f.INVALID_URL_ERR,B.status,B.response)}else{q(f.CONNECTION_ERR,B.status,B.response)}}};y.onprogress=function(A){if(w.onprogress){w.onprogress(A)}};y.onerror=function(){q(f.CONNECTION_ERR,this.status,this.response)};y.onabort=function(){q(f.ABORT_ERR,this.status,this.response)};y.open("GET",n,true);for(var t in p){if(p.hasOwnProperty(t)){y.setRequestHeader(t,p[t])}}y.responseType="blob";y.send()};g.prototype.abort=function(){if(this instanceof g){if(j[this._id]){j[this._id].abort();delete j[this._id]}}};a.exports=g});