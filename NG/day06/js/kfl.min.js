var app=angular.module("kfl",["ng","ngRoute"]);app.factory("$debounce",["$rootScope","$browser","$q","$exceptionHandler",function(b,a,e,f){var h={},d={},g=0;function c(p,m,n){var r=e.defer(),s=r.promise,k=(angular.isDefined(n)&&!n),q,i,o,j=false;angular.forEach(d,function(u,t){if(angular.equals(d[t].fn,p)){j=true;o=t}});if(!j){o=g++;d[o]={fn:p}}else{h[d[o].timeoutId].reject("bounced");a.defer.cancel(d[o].timeoutId)}var l=function(){delete d[o];try{r.resolve(p())}catch(t){r.reject(t);f(t)}if(!k){b.$apply()}};q=a.defer(l,m);d[o].timeoutId=q;i=function(t){delete h[s.$$timeoutId]};s.$$timeoutId=q;h[q]=r;s.then(i,i);return s}c.cancel=function(i){if(i&&i.$$timeoutId in h){h[i.$$timeoutId].reject("canceled");return a.defer.cancel(i.$$timeoutId)}return false};return c}]);app.config(function(a){a.when("/kflStart",{templateUrl:"tpl/start.html"}).when("/kflMain",{templateUrl:"tpl/main.html",controller:"MainCtrl"}).when("/kflDetail/:id",{templateUrl:"tpl/detail.html",controller:"DetailCtrl"}).when("/kflOrder/:id",{templateUrl:"tpl/order.html",controller:"OrderCtrl"}).when("/kflMyOrder",{templateUrl:"tpl/myOrder.html",controller:"MyOrderCtrl"}).otherwise({redirectTo:"/kflStart"})});app.controller("parentCtrl",["$scope","$location",function(a,b){a.jump=function(c){b.path(c)}}]);app.controller("MainCtrl",["$scope","$http","$debounce",function(a,d,c){a.kw="";a.hasMore=true;d.get("data/dish_getbypage.php").success(function(e){a.dishList=e});a.loadMore=function(){d.get("data/dish_getbypage.php?start="+a.dishList.length).success(function(e){if(e.length<5){a.hasMore=false}a.dishList=a.dishList.concat(e)})};var b=function(){d.get("data/dish_getbykw.php?kw="+a.kw).success(function(e){if(e.length>0){a.dishList=e}})};a.$watch("kw",function(){console.log(a.kw);if(a.kw.length>0){c(b,300)}})}]);app.controller("DetailCtrl",["$scope","$http","$routeParams",function(a,d,c){var b=c.id;d.get("data/dish_getbyid.php?id="+b).success(function(e){a.dish=e[0]})}]);app.controller("OrderCtrl",["$scope","$http","$routeParams","$httpParamSerializerJQLike",function(a,d,c,b){a.order={did:c.id};a.submitOrder=function(){console.log(a.order);var e=b(a.order);d.get("data/order_add.php?"+e).success(function(f){console.log(f);if(f[0].msg=="succ"){a.AddResult="下单成功，订单编号为"+f[0].oid;sessionStorage.setItem("phone",a.order.phone)}else{a.AddResult="下单失败"}})}}]);app.controller("MyOrderCtrl",["$scope","$http",function(b,c){var a=sessionStorage.getItem("phone");c.get("data/order_getbyphone.php?phone="+a).success(function(d){console.log(d);b.orderList=d})}]);